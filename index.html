<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chinese Zodiac Slot Machine</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css?family=Rubik:700&family=Allura&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Diphylleia&display=swap" rel="stylesheet">

<style>
/* BASE */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 16px;
  overflow-x: hidden;
}

body {
  text-align: center;
  font-family: "Diphylleia", serif;
  background: #ffe6e9; /* SOLID RED COLOR INSTEAD OF OMBRE */
  background-attachment: fixed;
  color: #fff;
  min-height: 100vh;
  padding: 10px;
  overflow-x: hidden;
  position: relative;
  width: 100%;
  max-width: 100%;
}

/* FIREWORKS CANVAS - TRANSPARENT OVERLAY */
#fireworksCanvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
  display: none;
  background-color: transparent !important; /* TRANSPARENT BACKGROUND */
}

/* PATTERN BACKGROUND */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
    radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
  background-size: 50px 50px;
  z-index: -1;
  pointer-events: none;
}

/* CHINESE BORDER DECORATION - GOLD BORDER */
.main-container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
  overflow: hidden;
  padding: max(10px, 2vw);
  background: rgba(255, 255, 255, 0.1);
  border-radius: clamp(15px, 2vw, 20px);
  border: max(4px, 0.5vw) double gold; /* CHANGED TO GOLD */
  box-shadow: 
    0 0 30px rgba(190, 56, 56, 0.5),
    inset 0 0 30px rgba(255, 255, 255, 0.2);
  z-index: 10;
}

/* TITLE IMAGE ONLY */
#title-img {
  display: block;
  width: min(95%, 600px);
  height: auto;
  margin: 0 auto max(15px, 2vw) auto;
  max-width: 100%;
  filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
}

/* LANTERNS CONTAINER */
.lanterns-container {
  width: 100%;
  position: relative;
  margin: max(15px, 2vw) 0 max(30px, 3vw) 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.lanterns-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  padding: 0 clamp(10px, 3vw, 30px);
  gap: clamp(10px, 3vw, 40px);
}

.lantern-left-container,
.lantern-right-container {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}

/* ENHANCED LANTERNS - RESPONSIVE */
.lantern {
  width: clamp(50px, 10vw, 100px);
  height: auto;
  aspect-ratio: 100/170;
  transform-origin: top center;
  animation: sway-left 5.5s ease-in-out infinite;
  flex-shrink: 0;
  filter: drop-shadow(0 10px 20px rgba(255, 215, 0, 0.5));
}

.lantern-right-container .lantern {
  animation: sway-right 5.5s ease-in-out infinite;
}

@keyframes sway-left { 
  0% { transform: rotate(-8deg); }
  50% { transform: rotate(8deg); }
  100% { transform: rotate(-8deg); } 
}

@keyframes sway-right { 
  0% { transform: rotate(8deg); }
  50% { transform: rotate(-8deg); }
  100% { transform: rotate(8deg); } 
}

/* CONTENT WRAPPER - RESPONSIVE */
.content-wrapper {
  flex: 1;
  display: flex;
  justify-content: center;
  min-width: min(300px, 80vw);
  max-width: min(400px, 90vw);
  padding: 0 clamp(10px, 2vw, 20px);
  position: relative;
  z-index: 2;
}

.content-box {
  width: 100%;
  background: rgba(255, 255, 255, 0.9);
  padding: clamp(15px, 2vw, 25px);
  border-radius: clamp(10px, 1.5vw, 15px);
  border: clamp(2px, 0.3vw, 3px) solid #be3838;
  box-shadow: 
    0 10px 30px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(255, 215, 0, 0.2);
}

.dropdown-button-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(15px, 2vw, 25px);
  width: 100%;
}

.dropdowns {
  display: flex;
  gap: clamp(5px, 1vw, 10px);
  justify-content: center;
  flex-wrap: wrap;
  width: 100%;
}

/* ENHANCED DROPDOWNS - RESPONSIVE */
select {
  padding: clamp(10px, 1vw, 14px) clamp(12px, 1vw, 16px);
  font-size: clamp(0.9rem, 1.1vw, 1.1rem);
  border: clamp(1px, 0.2vw, 2px) solid #be3838;
  border-radius: clamp(6px, 0.8vw, 8px);
  background: white;
  color: #333;
  min-width: clamp(80px, 9vw, 110px);
  cursor: pointer;
  font-family: "Diphylleia", serif;
  transition: all 0.3s ease;
  flex: 1;
  max-width: clamp(100px, 10vw, 130px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  position: relative;
}

select:focus {
  outline: none;
  box-shadow: 0 0 0 4px rgba(190, 56, 56, 0.3);
  border-color: #ff3333;
}

/* ENHANCED SPIN BUTTON - RESPONSIVE */
#spinButton {
  position: relative;
  font-family: "Diphylleia", serif;
  font-weight: 600;
  color: #382b22;
  text-transform: uppercase;
  padding: clamp(15px, 1.5vw, 22px) clamp(25px, 2.5vw, 40px);
  background: linear-gradient(145deg, #be3838, #972525);
  border: clamp(2px, 0.3vw, 3px) solid #000;
  border-radius: clamp(10px, 1vw, 15px);
  cursor: pointer;
  outline: 2px solid transparent;
  transform-style: preserve-3d;
  transition: all 0.2s ease;
  font-size: clamp(1.1rem, 1.5vw, 1.5rem);
  width: 100%;
  max-width: min(350px, 90vw);
  display: block;
  margin: 0 auto;
  box-shadow: 
    0 10px 20px rgba(0, 0, 0, 0.3),
    inset 0 2px 0 rgba(255, 255, 255, 0.4);
  overflow: hidden;
}

#spinButton::before {
  content: '';
  position: absolute; 
  width: 100%; 
  height: 100%; 
  top: 0; 
  left: 0;
  background: linear-gradient(145deg, #972525, #6a1a1a); 
  border-radius: inherit;
  transform: translate3d(0, 12px, -12px);
  transition: all 0.2s ease;
  z-index: -1;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

#spinButton:hover { 
  background: linear-gradient(145deg, #972525, #be3838); 
  transform: translateY(6px); 
}

#spinButton:hover::before { 
  transform: translate3d(0, 6px, -12px);
}

#spinButton:active { 
  background: linear-gradient(145deg, #6a1a1a, #972525); 
  transform: translateY(12px); 
}

#spinButton:active::before { 
  transform: translate3d(0, 0, -12px);
}

#spinButton .gold {
  display: inline-block;
  position: relative;
  font-weight: 600;
  text-transform: uppercase;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(90deg, #daa520 0%, #e8b923 25%, #ffde22 50%, #ffd700 75%, #b8860b 100%);
  background-size: 200% 100%;
  animation: goldShift 3s linear infinite;
  letter-spacing: 2px;
  z-index: 1;
  font-size: clamp(1.2rem, 1.8vw, 1.8rem);
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

@keyframes goldShift { 
  0% { background-position: 0% 50%; }
  100% { background-position: 200% 50%; } 
}

/* REELS SECTION - RESPONSIVE */
.reels-section {
  margin: clamp(30px, 5vw, 50px) auto;
  width: 100%;
  position: relative;
}

#reels {
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 300ms ease;
  gap: clamp(15px, 2vw, 25px);
  padding: 0 clamp(15px, 2vw, 20px);
  max-width: 100%;
  flex-wrap: wrap;
  position: relative;
  z-index: 2;
}

.reel-container {
  width: clamp(100px, 15vw, 150px);
  height: clamp(100px, 15vw, 150px);
  overflow: hidden;
  background: white;
  border: clamp(3px, 0.5vw, 5px) solid #be3838;
  position: relative;
  border-radius: clamp(15px, 2vw, 20px);
  box-shadow: 
    0 0 30px #fff,
    0 0 60px rgba(190, 56, 56, 0.8),
    inset 0 0 20px rgba(255, 215, 0, 0.3);
  animation: glow 2s infinite alternate;
  flex-shrink: 0;
}

@keyframes glow {
  0% { 
    box-shadow: 0 0 20px #fff, 
                0 0 40px rgba(190, 56, 56, 0.5),
                inset 0 0 10px rgba(255, 215, 0, 0.2); 
  }
  50% { 
    box-shadow: 0 0 40px #be3838, 
                0 0 80px rgba(175, 36, 36, 0.9),
                inset 0 0 30px rgba(255, 215, 0, 0.5); 
  }
  100% { 
    box-shadow: 0 0 20px #fff, 
                0 0 40px rgba(254, 230, 233, 0.5),
                inset 0 0 10px rgba(255, 215, 0, 0.2); 
  }
}

.reel {
  display: flex;
  flex-direction: column;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
}

.reel img {
  width: 100%;
  height: clamp(100px, 15vw, 150px);
  object-fit: contain;
  display: block;
  padding: clamp(5px, 1vw, 10px);
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
  object-fit: cover;
  border-radius: clamp(10px, 1.5vw, 15px);
}

/* SINGLE REEL MODE - RESPONSIVE */
.reel-container.single {
  width: clamp(200px, 30vw, 300px);
  height: clamp(200px, 30vw, 300px);
  margin: 0 auto;
}

.reel-container.single img.single-photo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: clamp(10px, 1.5vw, 15px);
}

/* TABS SECTION - FIXED TO SHOW ALL CONTENT */
.tabs-wrapper {
  display: none;
  margin-top: clamp(25px, 4vw, 40px);
  width: 100%;
}

.tabs-wrapper.active {
  display: block;
}

.wrapper {
  width: min(95%, 600px);
  margin: clamp(25px, 4vw, 40px) auto;
  padding: 0 clamp(15px, 2vw, 20px);
  position: relative;
}

.tabs-section [type="radio"] {
  display: none;
}

/* TAB LABELS - PROPERLY ON ONE LINE */
.tabs-section {
  position: relative;
  overflow-x: hidden;
  padding-bottom: 5px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: clamp(3px, 0.5vw, 5px);
}

.tabs-section label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: clamp(12px, 1vw, 16px) clamp(20px, 1.5vw, 25px);
  background: linear-gradient(to bottom, #972525, #be3838);
  color: #FFD700;
  cursor: pointer;
  font-weight: bold;
  border-radius: clamp(8px, 1vw, 10px) clamp(8px, 1vw, 10px) 0 0;
  position: relative;
  border: clamp(1px, 0.2vw, 2px) solid #000;
  border-bottom: none;
  white-space: nowrap;
  font-size: clamp(0.9rem, 1.1vw, 1.1rem);
  z-index: 2;
  transition: all 0.3s ease;
  min-width: clamp(110px, 9vw, 140px);
  flex-shrink: 0;
  font-family: "Diphylleia", serif;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.tabs-section label span {
  position: relative;
  z-index: 3;
}

/* 3D EFFECT */
.tabs-section label::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: clamp(6px, 0.8vw, 8px) clamp(6px, 0.8vw, 8px) 0 0;
  background: linear-gradient(to bottom, #be3838, #972525);
  border: clamp(1px, 0.2vw, 2px) solid #000;
  border-bottom: none;
  transform: perspective(120px) rotateX(20deg);
  z-index: 1;
}

/* FIXED: Current tab background matches content box background */
.tabs-section [type="radio"]:checked + label {
  background: white !important;
  color: #be3838 !important;
}

.tabs-section [type="radio"]:checked + label::after {
  background: white !important;
  z-index: 2;
}

.tabs-section [type="radio"]:checked + label span {
  color: #be3838;
  z-index: 3;
  font-weight: bold;
}

/* CONTENT BOX */
.tabs-content {
  position: relative;
  border: clamp(2px, 0.3vw, 3px) solid #000;
  border-radius: 0 0 clamp(8px, 1vw, 10px) clamp(8px, 1vw, 10px);
  background: white;
  color: #000;
  padding: clamp(20px, 2.5vw, 30px);
  min-height: min(200px, 50vh);
  max-height: 500px;
  overflow-y: auto;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  margin-top: -4px;
  z-index: 1;
  box-shadow: 
    0 10px 30px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(190, 56, 56, 0.1);
  font-family: "Diphylleia", serif;
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  white-space: normal !important;
}

.tabs-content section {
  display: none;
  width: 100%;
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  white-space: normal !important;
}

.tabs-content * {
  white-space: normal !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  word-break: break-word !important;
  max-width: 100%;
}

/* Tab switching */
#tab1:checked ~ .tabs-content #general,
#tab2:checked ~ .tabs-content #story,
#tab3:checked ~ .tabs-content #elements,
#tab4:checked ~ .tabs-content #famous {
  display: block;
}

/* SCROLLBAR */
.tabs-content::-webkit-scrollbar {
  width: 12px;
}

.tabs-content::-webkit-scrollbar-track {
  background: #fff;
  border-radius: 6px;
  border: 2px solid #be3838;
}

.tabs-content::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #be3838, #972525);
  border-radius: 6px;
  border: 2px solid #fff;
}

.tabs-content {
  scrollbar-width: thin;
  scrollbar-color: #be3838 #fff;
}

/* NEW YEAR MESSAGE - RESPONSIVE */
.new-year-message {
  font-family: "Diphylleia", serif;
  font-size: clamp(0.9rem, 1.2vw, 1.2rem); /* SMALLER FONT */
  color: rgb(255, 255, 255);
  text-align: center;
  margin: clamp(20px, 3vw, 30px) 0 clamp(10px, 1.5vw, 10px) 0;
  padding: clamp(8px, 1vw, 10px);
  background: #be3838;
  border-radius: clamp(8px, 1vw, 10px);
  border: clamp(1px, 0.2vw, 2px) solid gold;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

/* CHINESE CHARACTER STYLING - NOW USING DIPHYLLEA */
.chinese-char {
  font-family: "Diphylleia", serif;
  font-size: 1.2em;
  margin: 0 3px;
}

/* LUCKY SECTION */
.lucky-section {
  background: rgba(255, 215, 0, 0.1);
  padding: clamp(10px, 1vw, 15px);
  border-radius: clamp(8px, 1vw, 10px);
  margin: clamp(10px, 1vw, 15px) 0;
  border-left: clamp(3px, 0.4vw, 4px) solid gold;
}

/* ENHANCED RESPONSIVE DESIGN FOR VERY SMALL DEVICES */
@media screen and (max-width: 768px) {
  html {
    font-size: 14px;
  }
  
  /* Ensure lanterns still look good on small tablets */
  .lanterns-wrapper {
    flex-wrap: nowrap;
  }
  
  /* Better dropdown spacing */
  .dropdowns {
    gap: 8px;
  }
  
  select {
    min-width: 85px;
    max-width: 100px;
  }
}

@media screen and (max-width: 480px) {
  html {
    font-size: 13px;
  }
  
  /* Optimize for very small screens */
  .lanterns-wrapper {
    gap: 8px;
    padding: 0 5px;
  }
  
  .lantern {
    animation-duration: 4s; /* Slightly faster animation on mobile */
  }
  
  /* Ensure dropdowns are usable */
  .dropdowns {
    gap: 5px;
  }
  
  select {
    min-width: 75px;
    padding: 8px 10px;
    font-size: 0.9rem;
  }
  
  #spinButton {
    padding: 12px 20px;
    font-size: 1rem;
  }
  
  #spinButton .gold {
    font-size: 1.2rem;
  }
  
  /* Ensure reels are visible */
  #reels {
    gap: 10px;
  }
  
  .reel-container {
    width: 90px;
    height: 90px;
  }
  
  .reel img {
    height: 90px;
  }
  
  /* Adjust tabs for small screens */
  .tabs-section {
    gap: 2px;
  }
  
  .tabs-section label {
    min-width: 90px;
    padding: 8px 12px;
    font-size: 0.85rem;
  }
  
  .tabs-content {
    padding: 15px;
  }
  
  .new-year-message {
    font-size: 0.9rem;
    margin: 15px 0 8px 0;
    padding: 6px;
  }
}

/* EXTREME SMALL DEVICES */
@media screen and (max-width: 320px) {
  .lanterns-wrapper {
    gap: 5px;
  }
  
  .lantern {
    width: 40px; /* Minimum size */
  }
  
  .dropdowns {
    flex-direction: column;
    align-items: center;
  }
  
  select {
    min-width: 90%;
    max-width: 90%;
  }
  
  #reels {
    gap: 8px;
  }
  
  .reel-container {
    width: 80px;
    height: 80px;
  }
  
  .reel img {
    height: 80px;
  }
}

/* LARGE SCREENS ENHANCEMENT */
@media screen and (min-width: 1200px) {
  .main-container {
    max-width: 1400px;
  }
  
  .lantern {
    width: 110px;
  }
  
  .content-wrapper {
    max-width: 450px;
  }
  
  .reel-container {
    width: 170px;
    height: 170px;
  }
  
  .reel img {
    height: 170px;
  }
}
</style>
</head>
<body>
<!-- FIREWORKS CANVAS - TRANSPARENT OVERLAY -->
<canvas id="fireworksCanvas"></canvas>

<div class="main-container">

  <!-- TITLE IMAGE ONLY -->
  <img id="title-img" src="images/title.apng" alt="Chinese Zodiac Slot Machine">

  <div class="lanterns-container">
    <div class="lanterns-wrapper">
      <div class="lantern-left-container">
        <img src="images/Lantern.png" class="lantern" alt="Lantern">
      </div>
      
      <div class="content-wrapper">
        <div class="content-box">
          <div class="dropdown-button-column">
            <div class="dropdowns">
              <select id="month" aria-label="Birth month"></select>
              <select id="day" aria-label="Birth day"></select>
              <select id="year" aria-label="Birth year"></select>
            </div>
            <button id="spinButton" onclick="startSpin()" aria-label="Get my zodiac sign">
              <span class="gold">Discover My Zodiac!</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="lantern-right-container">
        <img src="images/Lantern.png" class="lantern" alt="Lantern">
      </div>
    </div>
  </div>

  <div class="reels-section">
    <div id="reels">
      <div class="reel-container">
        <div class="reel" id="reel1"></div>
        <img src="images/overlay.png" class="overlay" alt="Slot overlay">
      </div>
      <div class="reel-container">
        <div class="reel" id="reel2"></div>
        <img src="images/overlay.png" class="overlay" alt="Slot overlay">
      </div>
      <div class="reel-container">
        <div class="reel" id="reel3"></div>
        <img src="images/overlay.png" class="overlay" alt="Slot overlay">
      </div>
    </div>
  </div>

  <!-- TABS -->
  <div class="tabs-wrapper">
    <div class="wrapper">
      <section class="tabs-section">
        <input type="radio" name="tab" id="tab1" checked>
        <label for="tab1"><span>General Info</span></label>

        <input type="radio" name="tab" id="tab2">
        <label for="tab2"><span>Legend Story</span></label>

        <input type="radio" name="tab" id="tab3">
        <label for="tab3"><span>Elements & Years</span></label>

        <input type="radio" name="tab" id="tab4">
        <label for="tab4"><span>Famous People</span></label>

        <div class="tabs-content">
          <section id="general"></section>
          <section id="story"></section>
          <section id="elements"></section>
          <section id="famous"></section>
        </div>
      </section>
    </div>
  </div>

  <!-- NEW YEAR MESSAGE AT BOTTOM - SMALLER -->
  <div class="new-year-message">
     Gōng Xǐ Fā Cái! ❤︎ Wishing You Prosperity! ❤︎ Xīnnián Kuàilè! ❤︎⁠ Happy New Year!
  </div>

</div> <!-- end .main-container -->

<script>
// ============ FAST FIREWORKS WITH HEARTS, STARS AND BIGGER PARTICLES ============
class Fireworks {
  constructor(canvas) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d');
    this.particles = [];
    this.rockets = [];
    this.isActive = false;
    this.fireworksTimer = null;
    this.fireworksDuration = 5000; // 5 SECONDS
    
    this.resize();
    window.addEventListener('resize', () => this.resize());
  }
  
  resize() {
    this.canvas.width = window.innerWidth;
    this.canvas.height = window.innerHeight;
    this.width = this.canvas.width;
    this.height = this.canvas.height;
  }
  
  start() {
    if (this.isActive) return;
    
    this.isActive = true;
    this.canvas.style.display = 'block';
    
    // Clear any previous timer
    if (this.fireworksTimer) {
      clearTimeout(this.fireworksTimer);
    }
    
    // Set timer to stop after 5 seconds
    this.fireworksTimer = setTimeout(() => {
      this.stop();
    }, this.fireworksDuration);
    
    // Create initial rockets
    for (let i = 0; i < 6; i++) {
      this.createRocket();
    }
    
    // Create rockets frequently for fast effect
    this.rocketInterval = setInterval(() => {
      if (this.isActive && Math.random() < 0.7) {
        this.createRocket();
      }
    }, 250);
    
    this.animate();
  }
  
  stop() {
    this.isActive = false;
    clearInterval(this.rocketInterval);
    clearTimeout(this.fireworksTimer);
    
    // Quick fade out
    setTimeout(() => {
      this.canvas.style.display = 'none';
      this.particles = [];
      this.rockets = [];
    }, 300);
  }
  
  createRocket() {
    const rocket = {
      x: Math.random() * this.width,
      y: this.height,
      vx: (Math.random() - 0.5) * 5,
      vy: -Math.random() * 18 - 12, // FASTER UPWARD SPEED
      size: Math.random() * 2.5 + 1.5, // 5% BIGGER
      color: this.getRandomFireworkColor(),
      trail: [],
      type: this.getRandomExplosionType(),
      explosionSize: Math.random() * 90 + 110 // 5% BIGGER
    };
    this.rockets.push(rocket);
  }
  
  getRandomFireworkColor() {
    const colors = [
      '#FF0000', // Red
      '#FF9900', // Orange
      '#FFFF00', // Yellow
      '#00FF00', // Green
      '#0099FF', // Blue
      '#9900FF', // Purple
      '#FF00FF', // Magenta
      '#FFD700', // Gold
      '#FF1493', // Deep Pink
      '#FF69B4', // Hot Pink
      '#00FFFF', // Cyan
      '#FFA500'  // Dark Orange
    ];
    return colors[Math.floor(Math.random() * colors.length)];
  }
  
  getRandomExplosionType() {
    const types = ['circle', 'circle', 'heart', 'star', 'sparkle', 'heart', 'star']; // Added hearts and stars
    return types[Math.floor(Math.random() * types.length)];
  }
  
  explode(rocket) {
    // NORMAL PARTICLE COUNT WITH 5% INCREASE
    const particleCount = rocket.type === 'heart' ? 85 : rocket.type === 'star' ? 75 : 65;
    
    for (let i = 0; i < particleCount; i++) {
      let angle, speed, shape;
      
      angle = Math.random() * Math.PI * 2;
      speed = Math.random() * 8 + 4; // FASTER SPEED
      
      // Set shape based on rocket type
      if (rocket.type === 'heart') {
        shape = 'heart';
      } else if (rocket.type === 'star') {
        shape = 'star';
      } else if (rocket.type === 'sparkle') {
        shape = 'sparkle';
      } else {
        shape = 'circle';
      }
      
      const particle = {
        x: rocket.x,
        y: rocket.y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed,
        size: Math.random() * 3.15 + 1.05, // 5% BIGGER (1.05-4.2 pixels)
        color: Math.random() < 0.3 ? rocket.color : this.getRandomFireworkColor(),
        life: 100 + Math.random() * 50, // SHORTER LIFE FOR FASTER EFFECT
        decay: Math.random() * 0.06 + 0.04, // FASTER DECAY
        gravity: 0.08, // STRONGER GRAVITY FOR FASTER FALL
        flicker: Math.random() > 0.7,
        shape: shape,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.4,
        glow: Math.random() > 0.5
      };
      this.particles.push(particle);
    }
  }
  
  drawHeart(x, y, size) {
    this.ctx.save();
    this.ctx.beginPath();
    
    // Top left curve
    this.ctx.moveTo(x, y + size/4);
    this.ctx.bezierCurveTo(
      x - size/2, y - size/2,
      x - size, y + size/4,
      x, y + size
    );
    
    // Top right curve
    this.ctx.bezierCurveTo(
      x + size, y + size/4,
      x + size/2, y - size/2,
      x, y + size/4
    );
    
    this.ctx.closePath();
    this.ctx.fill();
    this.ctx.restore();
  }
  
  drawStar(x, y, outerRadius, innerRadius, points) {
    this.ctx.save();
    this.ctx.beginPath();
    
    for (let i = 0; i < points * 2; i++) {
      const angle = (i * Math.PI) / points;
      const radius = i % 2 === 0 ? outerRadius : innerRadius;
      const px = x + Math.cos(angle) * radius;
      const py = y + Math.sin(angle) * radius;
      
      if (i === 0) {
        this.ctx.moveTo(px, py);
      } else {
        this.ctx.lineTo(px, py);
      }
    }
    
    this.ctx.closePath();
    this.ctx.fill();
    this.ctx.restore();
  }
  
  drawSparkle(x, y, size) {
    this.ctx.save();
    this.ctx.beginPath();
    
    for (let i = 0; i < 8; i++) {
      const angle = (i * Math.PI) / 4;
      const px = x + Math.cos(angle) * size;
      const py = y + Math.sin(angle) * size;
      
      if (i === 0) {
        this.ctx.moveTo(px, py);
      } else {
        this.ctx.lineTo(px, py);
      }
      
      this.ctx.lineTo(x + Math.cos(angle + Math.PI/8) * size * 0.5, 
                     y + Math.sin(angle + Math.PI/8) * size * 0.5);
    }
    
    this.ctx.closePath();
    this.ctx.fill();
    this.ctx.restore();
  }
  
  drawParticle(particle) {
    this.ctx.save();
    
    // Add glow effect
    if (particle.glow && particle.life > 30) {
      this.ctx.shadowColor = particle.color;
      this.ctx.shadowBlur = 10; // 5% BIGGER GLOW
      this.ctx.shadowOffsetX = 0;
      this.ctx.shadowOffsetY = 0;
    }
    
    this.ctx.globalAlpha = particle.life / 100;
    this.ctx.fillStyle = particle.color;
    this.ctx.translate(particle.x, particle.y);
    this.ctx.rotate(particle.rotation);
    
    if (particle.shape === 'heart') {
      this.drawHeart(0, 0, particle.size * 2.1); // 5% BIGGER
    } else if (particle.shape === 'star') {
      this.drawStar(0, 0, particle.size * 1.58, particle.size * 0.84, 5); // 5% BIGGER
    } else if (particle.shape === 'sparkle') {
      this.drawSparkle(0, 0, particle.size * 1.58); // 5% BIGGER
    } else {
      // Circle - 5% BIGGER
      this.ctx.beginPath();
      this.ctx.arc(0, 0, particle.size * 1.05, 0, Math.PI * 2); // 5% BIGGER
      this.ctx.fill();
    }
    
    this.ctx.restore();
  }
  
  drawRocket(rocket) {
    // Draw rocket trail
    rocket.trail.forEach((trail, index) => {
      this.ctx.beginPath();
      this.ctx.fillStyle = rocket.color;
      this.ctx.globalAlpha = index / rocket.trail.length * 0.7;
      this.ctx.arc(trail.x, trail.y, rocket.size * (1 - index/rocket.trail.length), 0, Math.PI * 2);
      this.ctx.fill();
    });
    
    // Draw rocket
    this.ctx.save();
    this.ctx.shadowColor = rocket.color;
    this.ctx.shadowBlur = 10.5; // 5% BIGGER
    this.ctx.shadowOffsetX = 0;
    this.ctx.shadowOffsetY = 0;
    
    this.ctx.beginPath();
    this.ctx.fillStyle = rocket.color;
    this.ctx.globalAlpha = 1;
    this.ctx.arc(rocket.x, rocket.y, rocket.size, 0, Math.PI * 2);
    this.ctx.fill();
    this.ctx.restore();
    
    // Add to trail
    rocket.trail.push({x: rocket.x, y: rocket.y});
    if (rocket.trail.length > 10) {
      rocket.trail.shift();
    }
  }
  
  animate() {
    if (!this.isActive) return;
    
    // Clear with very light fade
    this.ctx.clearRect(0, 0, this.width, this.height);
    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    this.ctx.fillRect(0, 0, this.width, this.height);
    
    // Update and draw rockets - FASTER
    for (let i = this.rockets.length - 1; i >= 0; i--) {
      const rocket = this.rockets[i];
      
      rocket.x += rocket.vx;
      rocket.y += rocket.vy;
      rocket.vy += 0.12; // STRONGER GRAVITY FOR FASTER FALL
      
      this.drawRocket(rocket);
      
      // Explode when rocket reaches certain height or slows down
      if (rocket.vy >= -0.2 || rocket.y < this.height * 0.3) {
        this.explode(rocket);
        this.rockets.splice(i, 1);
      }
    }
    
    // Update and draw particles - FASTER
    for (let i = this.particles.length - 1; i >= 0; i--) {
      const particle = this.particles[i];
      
      particle.x += particle.vx;
      particle.y += particle.vy;
      particle.vy += particle.gravity;
      particle.vx *= 0.96; // FASTER DECELERATION
      particle.vy *= 0.96;
      particle.life -= particle.decay * 120; // FASTER LIFE DECAY
      particle.rotation += particle.rotationSpeed;
      
      if (particle.flicker) {
        particle.size *= 0.92; // FASTER SHRINK
      }
      
      this.drawParticle(particle);
      
      if (particle.life <= 0 || particle.size <= 0.3) {
        this.particles.splice(i, 1);
      }
    }
    
    requestAnimationFrame(() => this.animate());
  }
}

// Initialize fireworks
const fireworksCanvas = document.getElementById('fireworksCanvas');
const fireworks = new Fireworks(fireworksCanvas);

// ============ REST OF THE ZODIAC CODE ============

// Initialize variables at the top
let originalReelsHTML = null;
let isSpinning = false;
let resultsShown = false;

// ... (ALL YOUR EXISTING ZODIAC DATA CODE REMAINS THE SAME) ...

// Chinese greetings and phrases
const chineseGreetings = [
  "Gōngxǐ fācái (恭喜發財) - Wishing you prosperity",
  "Xīnnián kuàilè (新年快樂) - Happy New Year",
  "Jíxiáng rúyì (吉祥如意) - Good luck and happiness",
  "Wànshì rúyì (萬事如意) - May all your wishes come true",
  "Shēntǐ jiànkāng (身體健康) - Good health",
  "Niánnián yǒuyú (年年有餘) - Abundance year after year"
];

// Chinese directions and hours
const chineseHours = {
  "Rat": "11 PM - 1 AM (子時 - Zishi)",
  "Ox": "1 AM - 3 AM (丑時 - Choushi)",
  "Tiger": "3 AM - 5 AM (寅時 - Yinshi)",
  "Rabbit": "5 AM - 7 AM (卯時 - Maoshi)",
  "Dragon": "7 AM - 9 AM (辰時 - Chenshi)",
  "Snake": "9 AM - 11 AM (巳時 - Sishi)",
  "Horse": "11 AM - 1 PM (午時 - Wushi)",
  "Goat": "1 PM - 3 PM (未時 - Weishi)",
  "Monkey": "3 PM - 5 PM (申時 - Shenshi)",
  "Rooster": "5 PM - 7 PM (酉時 - Youshi)",
  "Dog": "7 PM - 9 PM (戌時 - Xushi)",
  "Pig": "9 PM - 11 PM (亥時 - Haishi)"
};

// Lucky numbers, colors, flowers, and directions - WITH MEANINGS
const luckyData = {
  "Rat": { 
    numbers: [2, 3], 
    colors: ["Blue (calm)", "Gold (wealth)", "Green (growth)"], 
    flowers: ["Lily (purity & wealth)", "African Violet (elegance)", "Lily of the Valley (sweetness)"],
    directions: ["Northeast (career luck)", "Due West (relationship luck)", "Southwest (health luck)"],
    bestWith: ["Dragon", "Monkey", "Ox"], 
    avoid: ["Horse", "Goat"]
  },
  "Ox": { 
    numbers: [1, 4, 6], 
    colors: ["Yellow (stability)", "Green (harmony)"], 
    flowers: ["Peony (wealth & honor)", "Tulip (perfect love)", "Plum Blossom (resilience)"],
    directions: ["Due North (career success)", "Southeast (wealth luck)"],
    bestWith: ["Rat", "Rooster", "Snake"], 
    avoid: ["Goat", "Horse"]
  },
  "Tiger": { 
    numbers: [1, 3, 4], 
    colors: ["Blue (trust)", "Gray (balance)", "White (purity)"], 
    flowers: ["Orchid (nobility)", "Anthurium (hospitality)", "Azalea (passion)"],
    directions: ["Northeast (power)", "Due South (fame)", "Northwest (helpful people)"],
    bestWith: ["Horse", "Dog", "Pig"], 
    avoid: ["Monkey", "Snake"]
  },
  "Rabbit": { 
    numbers: [3, 4, 6], 
    colors: ["Red (vitality)", "Pink (romance)", "Purple (spirituality)"], 
    flowers: ["Jasmine (friendship)", "Lotus (purity)", "Osmanthus (success)"],
    directions: ["Due East (health)", "Southeast (wealth)", "Due South (recognition)"],
    bestWith: ["Goat", "Pig", "Dog"], 
    avoid: ["Rooster", "Rat"]
  },
  "Dragon": { 
    numbers: [1, 6, 7], 
    colors: ["Gold (success)", "Silver (intuition)", "Grayish White (purity)"], 
    flowers: ["Clerodendrum (dragon's power)", "Cactus Flower (protection)", "Gladiolus (strength)"],
    directions: ["Due East (growth)", "Southeast (prosperity)", "Due North (career)"],
    bestWith: ["Rat", "Monkey", "Rooster"], 
    avoid: ["Dog", "Rabbit"]
  },
  "Snake": { 
    numbers: [2, 8, 9], 
    colors: ["Black (mystery)", "Red (passion)", "Yellow (wisdom)"], 
    flowers: ["Orchid (refinement)", "Red Rose (love)", "Cactus (protection)"],
    directions: ["Southeast (wisdom)", "South (passion)", "Southwest (relationships)"],
    bestWith: ["Rooster", "Ox", "Monkey"], 
    avoid: ["Pig", "Tiger"]
  },
  "Horse": { 
    numbers: [2, 3, 7], 
    colors: ["Yellow (optimism)", "Green (growth)", "Brown (stability)"], 
    flowers: ["Carnation (energy)", "Chrysanthemum (longevity)", "Sunflower (happiness)"],
    directions: ["South (recognition)", "Southwest (romance)", "West (creativity)"],
    bestWith: ["Tiger", "Goat", "Dog"], 
    avoid: ["Rat", "Ox"]
  },
  "Goat": { 
    numbers: [2, 7], 
    colors: ["Green (peace)", "Red (vitality)", "Purple (spirituality)"], 
    flowers: ["Carnation (love)", "Gladiolus (integrity)", "Primrose (youthfulness)"],
    directions: ["Southwest (relationships)", "West (creativity)", "Northwest (helpful people)"],
    bestWith: ["Rabbit", "Horse", "Pig"], 
    avoid: ["Ox", "Rat"]
  },
  "Monkey": { 
    numbers: [4, 9], 
    colors: ["White (clarity)", "Gold (wealth)", "Blue (communication)"], 
    flowers: ["Orchid (intelligence)", "Chrysanthemum (cheerfulness)", "Carnation (versatility)"],
    directions: ["West (social luck)", "Northwest (opportunities)", "North (career)"],
    bestWith: ["Dragon", "Rat", "Snake"], 
    avoid: ["Tiger", "Pig"]
  },
  "Rooster": { 
    numbers: [5, 7, 8], 
    colors: ["Gold (success)", "Brown (reliability)", "Yellow (confidence)"], 
    flowers: ["Gladiolus (strength)", "Cockscomb (vitality)", "Marigold (protection)"],
    directions: ["West (creativity)", "Northwest (opportunities)", "South (recognition)"],
    bestWith: ["Ox", "Snake", "Dragon"], 
    avoid: ["Rabbit", "Dog"]
  },
  "Dog": { 
    numbers: [3, 4, 9], 
    colors: ["Red (passion)", "Green (growth)", "Purple (spirituality)"], 
    flowers: ["Rose (loyalty)", "Chrysanthemum (honesty)", "Orchid (nobility)"],
    directions: ["Northwest (helpful people)", "East (family)", "South (fame)"],
    bestWith: ["Tiger", "Horse", "Rabbit"], 
    avoid: ["Dragon", "Rooster"]
  },
  "Pig": { 
    numbers: [2, 5, 8], 
    colors: ["Yellow (optimism)", "Gray (balance)", "Brown (stability)"], 
    flowers: ["Hydrangea (gratitude)", "Daisy (innocence)", "Calla Lily (beauty)"],
    directions: ["North (career)", "Northeast (knowledge)", "South (social)"],
    bestWith: ["Rabbit", "Goat", "Tiger"], 
    avoid: ["Snake", "Monkey"]
  }
};

// ... (ALL YOUR EXISTING ZODIAC DATA CONTINUES) ...

const zodiacData = {
  "Rat": {
    story: "In the legendary Jade Emperor's race, the clever Rat hitched a ride on the diligent Ox's back. Just before the finish line, the Rat jumped ahead to claim first place. In Chinese culture, Rats symbolize intelligence, adaptability, and wealth accumulation. People born in Rat years are quick-witted, resourceful, and possess strong survival instincts. They excel in business and are known for their charming personalities.",
    culturalSignificance: "Rats are associated with wealth in Chinese culture. The expression 'money rat' refers to someone skilled at accumulating wealth. Rat hours (11 PM - 1 AM) mark the beginning of a new day in traditional timekeeping.",
    bestMatches: "Best matches: Dragon, Monkey, Ox",
    worstMatches: "Avoid: Horse, Goat"
  },
  
  "Ox": {
    story: "The Ox finished second in the race due to its steady, reliable pace. In ancient China, the Ox was revered as a sacred animal and essential for agriculture. Oxen represent diligence, strength, and dependability. Those born in Ox years are patient, methodical, and possess strong moral character. They are the backbone of society—hardworking, trustworthy, and capable of bearing great responsibility without complaint.",
    culturalSignificance: "The Ox is central to agricultural life and represents spring planting. Oxen are honored during the Spring Plowing Ceremony. Their hardworking nature made them symbols of perseverance in Confucian philosophy.",
    bestMatches: "Best matches: Rat, Rooster, Snake",
    worstMatches: "Avoid: Goat, Horse"
  },
  
  "Tiger": {
    story: "The powerful Tiger finished third, roaring across the finish line. In Chinese mythology, the Tiger is king of the mountain and protects against evil spirits. Tigers symbolize bravery, power, and unpredictability. Tiger-year individuals are natural leaders—courageous, competitive, and passionate. They command respect but can be impulsive. The Tiger's third-place finish reflects its tendency to act first and think later.",
    culturalSignificance: "Tigers protect against three main disasters: fire, thieves, and ghosts. Tiger shoes were traditionally worn by children for protection. The White Tiger is one of the Four Symbols of Chinese constellations.",
    bestMatches: "Best matches: Horse, Dog, Pig",
    worstMatches: "Avoid: Monkey, Snake"
  },
  
  "Rabbit": {
    story: "The gentle Rabbit crossed the river by hopping skillfully from stone to stone. In Chinese folklore, the Rabbit lives on the moon with the Moon Goddess Chang'e, pounding the elixir of immortality. Rabbits represent grace, diplomacy, and longevity. Rabbit-year people are elegant, peaceful, and articulate. They avoid conflict and possess keen artistic sensibilities. Their fourth-place finish shows their careful, calculated approach.",
    culturalSignificance: "The Jade Rabbit pounds medicinal herbs on the moon. Rabbit symbolizes the moon (yin) while Rooster symbolizes the sun (yang). Rabbit charms promote longevity and peace.",
    bestMatches: "Best matches: Goat, Pig, Dog",
    worstMatches: "Avoid: Rooster, Rat"
  },
  
  "Dragon": {
    story: "Despite its ability to fly, the Dragon came fifth because it stopped to create rain for drought-stricken villages. The Dragon is the only mythical creature in the zodiac and symbolizes imperial power, success, and good fortune. Dragon-year individuals are charismatic, ambitious, and destined for greatness. They are natural innovators but can be arrogant. The Dragon's delay reflects its sense of responsibility toward others.",
    culturalSignificance: "The Dragon represents yang energy and imperial authority. Dragons control water and weather. The nine sons of the dragon appear throughout Chinese architecture as protective figures.",
    bestMatches: "Best matches: Rat, Monkey, Rooster",
    worstMatches: "Avoid: Dog, Rabbit"
  },
  
  "Snake": {
    story: "The Snake quietly crossed the river by wrapping around the Horse's leg, startling it at the last moment. In Chinese tradition, the Snake represents wisdom, mystery, and rebirth (shedding skin). Snake-year people are philosophical, intuitive, and possess deep intelligence. They appear calm but are fiercely determined. Their sixth-place finish demonstrates their strategic patience—striking at the perfect moment.",
    culturalSignificance: "Also called 'Little Dragon,' the Snake represents wisdom and feminine energy. In some regions, it's considered lucky to dream of snakes, indicating coming wealth or pregnancy.",
    bestMatches: "Best matches: Rooster, Ox, Monkey",
    worstMatches: "Avoid: Pig, Tiger"
  },
  
  "Horse": {
    story: "The fast Horse nearly won but was startled when the Snake revealed itself. Horses symbolize freedom, energy, and travel. Horse-year individuals are independent, cheerful, and popular in social circles. They possess great physical energy and love adventure but can be impatient. The Horse's seventh-place finish reflects how their impulsiveness sometimes undermines their natural advantages.",
    culturalSignificance: "Horses symbolize speed and success. The 'heavenly horse' was believed to carry souls to immortality. Horse statues face outward from buildings to carry away bad luck.",
    bestMatches: "Best matches: Tiger, Goat, Dog",
    worstMatches: "Avoid: Rat, Ox"
  },
  
  "Goat": {
    story: "The peaceful Goat crossed the river calmly, helping others along the way. In Chinese culture, the Goat symbolizes harmony, creativity, and gentleness. Goat-year people are artistic, compassionate, and seek peaceful environments. They excel in creative fields but can be indecisive. Their eighth-place finish shows their tendency to prioritize others' needs over their own success.",
    culturalSignificance: "The Goat's gentle nature represents filial piety. The character for 'beauty' combines 'sheep' and 'big.' Goats symbolize peace and are often depicted in pastoral art.",
    bestMatches: "Best matches: Rabbit, Horse, Pig",
    worstMatches: "Avoid: Ox, Rat"
  },
  
  "Monkey": {
    story: "The clever Monkey used vines to swing across the river. Monkeys symbolize intelligence, playfulness, and problem-solving. Monkey-year individuals are witty, inventive, and excel at turning difficult situations to their advantage. They are natural entertainers but can be mischievous. Their ninth-place finish demonstrates their unconventional approach—they find creative shortcuts rather than following traditional paths.",
    culturalSignificance: "The Monkey King Sun Wukong from Journey to the West embodies rebellion and cleverness. Monkeys represent adaptability and are considered lucky in business ventures.",
    bestMatches: "Best matches: Dragon, Rat, Snake",
    worstMatches: "Avoid: Tiger, Pig"
  },
  
  "Rooster": {
    story: "The Rooster built a raft to cross but stopped to help others. Roosters symbolize punctuality, honesty, and flamboyance. Rooster-year people are organized, hardworking, and take pride in their appearance. They are perfectionists who speak directly but can be critical. Their tenth-place finish reflects their sense of duty—they help others even at personal cost.",
    culturalSignificance: "Roosters symbolize the sun and honesty. Their crow dispels darkness and evil. The five virtues: literary, martial, courageous, benevolent, and trustworthy.",
    bestMatches: "Best matches: Ox, Snake, Dragon",
    worstMatches: "Avoid: Rabbit, Dog"
  },
  
  "Dog": {
    story: "The loyal Dog was busy playing in the water and ensuring everyone's safety. Dogs represent loyalty, justice, and protection. Dog-year individuals are honest, faithful, and have strong moral principles. They make excellent friends and protectors but can be pessimistic. Their eleventh-place finish shows their selfless nature—they prioritize community safety over personal victory.",
    culturalSignificance: "Dogs represent earth energy and loyalty. The heavenly dog was thought to cause eclipses by eating the sun/moon. Dog sacrifices were made to ensure good harvests.",
    bestMatches: "Best matches: Tiger, Horse, Rabbit",
    worstMatches: "Avoid: Dragon, Rooster"
  },
  
  "Pig": {
    story: "The Pig arrived last after stopping to eat and rest. In Chinese culture, the Pig symbolizes generosity, diligence, and abundance. Pig-year people are sincere, tolerant, and enjoy life's pleasures. They are reliable friends with good financial sense but can be naive. Their twelfth-place finish reflects their contented nature—they appreciate the journey as much as the destination.",
    culturalSignificance: "The Pig represents the end of the agricultural cycle and abundance. Piggy banks originated from this association with wealth. In some dialects, 'pig' is used affectionately for loved ones.",
    bestMatches: "Best matches: Rabbit, Goat, Tiger",
    worstMatches: "Avoid: Snake, Monkey"
  }
};

// ---------------- ACCURATE CHINESE ZODIAC DATA ----------------
const animals = ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"];
const chineseSymbol = { Rat:'鼠', Ox:'牛', Tiger:'虎', Rabbit:'兔', Dragon:'龍', Snake:'蛇', Horse:'馬', Goat:'羊', Monkey:'猴', Rooster:'雞', Dog:'狗', Pig:'豬' };
const elements = ["Wood","Fire","Earth","Metal","Water"];
const elementChinese = { Wood:'木', Fire:'火', Earth:'土', Metal:'金', Water:'水' };

// ELEMENT COLORS
const elementColors = {
  "Wood": "#F0E2C9",
  "Fire": "#fffafb",
  "Earth": "#E8EDD0",
  "Metal": "#F0F0F0",
  "Water": "#DEF0FA"
};

// UPDATED ELEMENTS DESCRIPTIONS
const elementDescriptions = {
  "Wood": "Wood represents growth, creativity, and flexibility. Wood signs are visionary, idealistic, and able to see the big picture.",
  "Fire": "Fire represents passion, energy, and transformation. Fire signs are enthusiastic, dynamic, and natural leaders.",
  "Earth": "Earth represents stability, practicality, and reliability. Earth signs are grounded, patient, and hardworking.",
  "Metal": "Metal represents structure, determination, and strength. Metal signs are disciplined, resolute, and value integrity.",
  "Water": "Water represents wisdom, intuition, and adaptability. Water signs are perceptive, empathetic, and deeply emotional."
};

// CORRECTED ZODIAC YEARS
const zodiacYears = {
  "Rat": { 
    "Wood":[1924,1984,2044],
    "Fire":[1936,1996,2056],
    "Earth":[1948,2008,2068],
    "Metal":[1960,2020,2080],
    "Water":[1912,1972,2032] 
  },
  "Ox": { 
    "Wood":[1925,1985,2045],
    "Fire":[1937,1997,2057],
    "Earth":[1949,2009,2069],
    "Metal":[1961,2021,2081],
    "Water":[1913,1973,2033] 
  },
  "Tiger": { 
    "Wood":[1914,1974,2034],
    "Fire":[1926,1986,2046],
    "Earth":[1938,1998,2058],
    "Metal":[1950,2010,2070],
    "Water":[1962,2022,2082] 
  },
  "Rabbit": { 
    "Wood":[1915,1975,2035],
    "Fire":[1927,1987,2047],
    "Earth":[1939,1999,2059],
    "Metal":[1951,2011,2071],
    "Water":[1963,2023,2083] 
  },
  "Dragon": { 
    "Wood":[1904,1964,2024],
    "Fire":[1916,1976,2036],
    "Earth":[1928,1988,2048],
    "Metal":[1940,2000,2060],
    "Water":[1952,2012,2072] 
  },
  "Snake": { 
    "Wood":[1905,1965,2025],
    "Fire":[1917,1977,2037],
    "Earth":[1929,1989,2049],
    "Metal":[1941,2001,2061],
    "Water":[1953,2013,2073] 
  },
  "Horse": { 
    "Wood":[1954,2014,2074],
    "Fire":[1906,1966,2026],
    "Earth":[1918,1978,2038],
    "Metal":[1930,1990,2050],
    "Water":[1942,2002,2062] 
  },
  "Goat": { 
    "Wood":[1955,2015,2075],
    "Fire":[1907,1967,2027],
    "Earth":[1919,1979,2039],
    "Metal":[1931,1991,2051],
    "Water":[1943,2003,2063] 
  },
  "Monkey": { 
    "Wood":[1944,2004,2064],
    "Fire":[1956,2016,2076],
    "Earth":[1908,1968,2028],
    "Metal":[1920,1980,2040],
    "Water":[1932,1992,2052] 
  },
  "Rooster": { 
    "Wood":[1945,2005,2065],
    "Fire":[1957,2017,2077],
    "Earth":[1909,1969,2029],
    "Metal":[1921,1981,2041],
    "Water":[1933,1993,2053] 
  },
  "Dog": { 
    "Wood":[1934,1994,2054],
    "Fire":[1946,2006,2066],
    "Earth":[1910,1970,2030],
    "Metal":[1922,1982,2042],
    "Water":[1958,2018,2078] 
  },
  "Pig": { 
    "Wood":[1935,1995,2055],
    "Fire":[1947,2007,2067],
    "Earth":[1911,1971,2031],
    "Metal":[1923,1983,2043],
    "Water":[1959,2019,2079] 
  }
};

// FIXED: Famous People with correct pluralization
const famousPeople = {
  "Rat": ["Severus Snape: born on January 9, 1960, a Metal Rat 鼠", "Wolfgang Amadeus Mozart: born on January 27, 1756, a Fire Rat 鼠", "Samuel L. Jackson: born on December 21, 1948, an Earth Rat 鼠", "Avril Lavigne: born on September 27, 1984, a Wood Rat 鼠", "Tom Holland: born on June 1, 1996, a Fire Rat 鼠"],
  "Ox": ["Barack Obama: born on August 4, 1961, a Metal Ox 牛", "Vincent Van Gogh: born on March 30, 1853, a Water Ox 牛", "Walt Disney: born on December 5, 1901, a Metal Ox 牛", "Meryl Streep: born on June 22, 1949, an Earth Ox 牛"],
  "Tiger": ["Leonardo DiCaprio: born on November 11, 1974, a Wood Tiger 虎", "Tom Marvolo Riddle: born on December 31, 1926, a Fire Tiger 虎", "Audrey Hepburn: born on May 4, 1929, an Earth Tiger 虎", "Lady Gaga: born on March 28, 1986, a Fire Tiger 虎", "Taylor Swift: born on December 13, 1989, an Earth Tiger 虎"],
  "Rabbit": ["Albert Einstein: born on March 14, 1879, an Earth Rabbit 兔", "Keanu Reeves: born on September 2, 1964, a Wood Rabbit 兔", "Emma Watson: born on April 15, 1990, a Metal Rabbit 兔", "Indiana Jones: born on July 1, 1899, an Earth Rabbit 兔"],
  "Dragon": ["Bruce Lee: born on November 27, 1940, a Metal Dragon 龍", "John Lennon: born on October 9, 1940, a Metal Dragon 龍", "Rihanna: born on February 20, 1988, an Earth Dragon 龍", "Sandra Bullock: born on July 26, 1964, a Wood Dragon 龍", "Kendrick Lamar: born on June 17, 1987, a Fire Dragon 龍"],
  "Snake": ["Pablo Picasso: born on October 25, 1881, a Metal Snake 蛇", "Bob Dylan: born on May 24, 1941, a Metal Snake 蛇", "Halle Berry: born on August 14, 1966, a Fire Snake 蛇"],
  "Horse": ["Princess Diana: born on July 1, 1961, a Metal Horse 馬", "Paul McCartney: born on June 18, 1942, a Water Horse 馬", "Neil Armstrong: born on August 5, 1930, a Metal Horse 馬"],
  "Goat": ["Steve Jobs: born on February 24, 1955, an Earth Goat 羊", "Billie Eilish: born on December 18, 2001, a Metal Goat 羊", "Hermione Jean Granger: born on September 19, 1979, a Earth Goat 羊", "Chris Hemsworth: born on August 11, 1983, a Water Goat 羊"],
  "Monkey": ["Leonardo da Vinci: born on April 15, 1452, a Wood Monkey 猴", "Angelina Jolie: born on June 4, 1975, a Wood Monkey 猴", "Harry James Potter: born on July 31, 1980, a Metal Monkey 猴", "Diana Ross: born on March 26, 1944, a Wood Monkey 猴", "Marty McFly: born on June 12, 1968, an Earth Monkey 猴"],
  "Rooster": ["Jennifer Aniston: born on February 11, 1969, an Earth Rooster 雞", "Benedict Cumberbatch: born on July 19, 1976, a Fire Rooster 雞", "Beyoncé: born on September 4, 1981, a Metal Rooster 雞", "Anne Hathaway: born on November 12, 1982, a Water Rooster 雞", "Robert Downey Jr: born on April 4, 1965, a Wood Rooster 雞", "Lady Gaga: born on March 28, 1986, a Fire Rooster 雞"],
  "Dog": ["Elvis Presley: born on January 8, 1935, a Wood Dog 狗", "Michael Jackson: born on August 29, 1958, an Earth Dog 狗", "Morgan Freeman: born on June 1, 1937, a Fire Dog 狗", "Adam Sandler: born on September 9, 1966, a Fire Dog 狗", "Eminem: born on October 17, 1972, a Water Dog 狗", "Lin‑Manuel Miranda: born on January 16, 1980, a Metal Dog 狗", "Jerry Springer: born on February 13, 1944, a Wood Dog 狗", "Maury Povich: born on January 17, 1939, an Earth Dog 狗"],
  "Pig": ["Barbra Streisand: born on April 24, 1942, a Water Pig 豬", "Henry Cavill: born on May 5, 1983, a Water Pig 豬", "Cristiano Ronaldo: born on February 5, 1985, a Wood Pig 豬", "Jackie Chan: born on April 7, 1954, a Wood Pig 豬", "Bad Bunny: born on March 10, 1994, a Wood Pig 豬", "Daniel Radcliffe: born on July 23, 1989, an Earth Pig 豬", "Lucy Liu: born on December 2, 1968, an Earth Pig 豬"]
};

/* ---------------- HELPER FUNCTION TO ADD CHINESE CHARACTER ---------------- */
function addChineseCharacter(animal) {
  return `${animal} <span class="chinese-char">${chineseSymbol[animal]}</span>`;
}

/* ---------------- HELPER FUNCTION TO GET RANDOM GREETING ---------------- */
function getRandomGreeting() {
  return chineseGreetings[Math.floor(Math.random() * chineseGreetings.length)];
}

/* ---------------- FUNCTION TO HIDE RESULTS ---------------- */
function hideResults() {
  const tabsWrapper = document.querySelector('.tabs-wrapper');
  tabsWrapper.classList.remove('active');
  resultsShown = false;
  
  // Reset to three reels if showing single
  const reelsDiv = document.getElementById("reels");
  if (!document.getElementById("reel1") && originalReelsHTML) {
    reelsDiv.innerHTML = originalReelsHTML;
    initReels();
  }
}

/* ---------------- INIT DROPDOWNS ---------------- */
function initBirthdayDropdowns(){
  const month = document.getElementById("month");
  const day = document.getElementById("day");
  const year = document.getElementById("year");
  
  // Months
  const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  months.forEach((m, i) => {
    const option = new Option(m, i + 1);
    month.add(option);
  });
  
  // Days
  for(let d = 1; d <= 31; d++) {
    day.add(new Option(d, d));
  }
  
  // Years - START AT 2026
  const startYear = 2026;
  const endYear = startYear - 100;
  
  for(let y = startYear; y >= endYear; y--) {
    year.add(new Option(y, y));
  }
  
  // Set default values
  month.value = 1;
  day.value = 1;
  year.value = startYear;
  
  // ADD EVENT LISTENERS TO HIDE RESULTS WHEN DROPDOWNS CHANGE
  month.addEventListener('change', hideResults);
  day.addEventListener('change', hideResults);
  year.addEventListener('change', hideResults);
}

/* ---------------- ZODIAC CALCULATION ---------------- */
function getUserZodiacFromDropdown(){
  const y = parseInt(document.getElementById("year").value);
  const m = parseInt(document.getElementById("month").value);
  const d = parseInt(document.getElementById("day").value);
  
  if (isNaN(y)) {
    return {animal: "Dragon", element: "Wood", year: 2024};
  }
  
  const animalIndex = ((y - 1900) % 12 + 12) % 12;
  const elementIndex = ((y - 1900) % 10 + 10) % 10;
  
  const animal = animals[animalIndex];
  
  // Map element index to element
  let element;
  switch(elementIndex) {
    case 0: case 1: element = "Metal"; break;
    case 2: case 3: element = "Water"; break;
    case 4: case 5: element = "Wood"; break;
    case 6: case 7: element = "Fire"; break;
    case 8: case 9: element = "Earth"; break;
    default: element = "Wood";
  }
  
  return {animal: animal, element: element, year: y};
}

/* ---------------- GENERATE TAB CONTENT ---------------- */
function generateZodiacText(animal, element, year){
  // Create the animal with Chinese character
  const animalWithChinese = addChineseCharacter(animal);
  const elementWithChinese = `${element} <span class="chinese-char">${elementChinese[element]}</span>`;
  
  // Get lucky data
  const lucky = luckyData[animal];
  const hours = chineseHours[animal];
  
  // Get a random greeting
  const greeting = getRandomGreeting();
  
  // 1. Generate General Info - ENHANCED WITH LUCKY DATA INCLUDING FLOWERS AND DIRECTIONS
  let generalText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
                <strong>Your Zodiac: ${elementWithChinese} ${animalWithChinese} (${year})</strong>
              </div>
              <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
              <div style="font-size: 0.95em; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
                <strong>Personality Traits:</strong><br>
                ${zodiacData[animal].story.split('. ').slice(1).join('. ')}
                
                <div class="lucky-section">
                  <strong>🗓️ Chinese Hour:</strong> ${hours}<br>
                  <strong>🎯 Lucky Numbers:</strong> ${lucky.numbers.join(', ')}<br>
                  <strong>🎨 Lucky Colors:</strong> ${lucky.colors.join(', ')}<br>
                  <strong>🌸 Lucky Flowers:</strong> ${lucky.flowers.join(', ')}<br>
                  <strong>🧭 Lucky Directions:</strong> ${lucky.directions.join(', ')}<br>
                  <strong>❤️ Best Matches:</strong> ${lucky.bestWith.join(', ')}<br>
                  <strong>⚠️ Avoid:</strong> ${lucky.avoid.join(', ')}
                </div>
                
                <strong>Cultural Significance:</strong><br>
                ${zodiacData[animal].culturalSignificance}
                <br><br>
                <div style="background: #FFF9C4; padding: 10px; border-radius: 6px; border-left: 4px solid gold;">
                  <strong>🎊 Chinese Blessing:</strong> ${greeting}
                </div>
                <br>
                <em style="font-size: 0.85em; color: #666;">Note: Chinese New Year falls between Jan 21-Feb 20. If born in Jan/Feb, you might be previous year's zodiac.</em>
              </div>`;
  
  // 2. Generate History content
  const storyText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            <strong>The Legend of the ${animalWithChinese}</strong>
          </div>
          <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
          <div style="font-size: 0.95em; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            <p>${zodiacData[animal].story}</p>
            <br>
            <div style="background: #fffafb; padding: 10px; border-radius: 6px; border-left: 4px solid #be3838;">
              <strong>Cultural Insight:</strong><br>
              ${zodiacData[animal].culturalSignificance}
              <br><br>
              <strong>Compatibility:</strong><br>
              ${zodiacData[animal].bestMatches}<br>
              ${zodiacData[animal].worstMatches}
            </div>
          </div>`;
  
  // 3. Generate Elements content
  let elementsText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
                <strong>Chinese Zodiac Elements & Years for ${animalWithChinese}</strong>
              </div>
              <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
              <div style="font-size: 0.95em; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">`;
  
  const orderedElements = [element];
  elements.forEach(el => {
    if (el !== element) {
      orderedElements.push(el);
    }
  });
  
  orderedElements.forEach(el => {
    const isCurrent = el === element;
    const yearsForElement = zodiacYears[animal] && zodiacYears[animal][el] ? 
      zodiacYears[animal][el].filter(y => y <= 2100 && y >= 1900) : [];
    
    const elementColor = elementColors[el];
    const backgroundColor = isCurrent ? '#ffe6e9' : elementColor;
    const borderColor = isCurrent ? '#be3838' : getDarkerColor(elementColor);
    
    elementsText += `<div style="margin-bottom: 15px; padding: 10px; background: ${backgroundColor}; border-radius: 6px; border-left: 4px solid ${borderColor}; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
              <strong>${el} <span class="chinese-char">${elementChinese[el]}</span></strong><br>
              ${elementDescriptions[el]}<br><br>
              <strong>${el} ${elementChinese[el]} ${animalWithChinese} Years:</strong><br>
              ${yearsForElement.length > 0 ? 
                yearsForElement.join(', ') : 
                'No years available for this element'}
              ${isCurrent ? '<br><br><em style="color: #be3838; font-size: 1.2em; font-weight: bold;">✓ Your element & year</em>' : ''}
            </div>`;
  });
  
  elementsText += "</div>";
  
  // 4. Generate Famous People content - FIXED PLURALIZATION
  const animalPlural = animal === "Ox" ? "Oxen" : 
                      animal === "Goat" ? "Goats" :
                      animal.endsWith("s") || animal.endsWith("x") || animal.endsWith("ch") || animal.endsWith("sh") ? 
                      animal + "es" : animal + "s";
  
  const famousText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            <strong>Famous ${animalPlural} ${chineseSymbol[animal]}</strong>
          </div>
          <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
          <div style="font-size: 0.9em; line-height: 1.3; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            ${famousPeople[animal].join("<br>")}
          </div>`;
  
  // Set all the content
  document.getElementById("general").innerHTML = generalText;
  document.getElementById("story").innerHTML = storyText;
  document.getElementById("elements").innerHTML = elementsText;
  document.getElementById("famous").innerHTML = famousText;
}

/* ---------------- HELPER FUNCTION FOR DARKER COLORS ---------------- */
function getDarkerColor(hexColor) {
  const colorMap = {
    "#F0E2C9": "#8B6B2F",
    "#fffafb": "#D32F2F",
    "#E8EDD0": "#8B8D4A",
    "#F0F0F0": "#808080",
    "#DEF0FA": "#2E8BCC"
  };
  return colorMap[hexColor] || "#972525";
}

/* ---------------- INITIALIZE REELS ---------------- */
function initReels(){
  const reelContainers = document.querySelectorAll('.reel-container');
  if (reelContainers.length === 0) return;
  
  const reelHeight = reelContainers[0].offsetHeight;
  
  for(let i = 1; i <= 3; i++){
    const reel = document.getElementById("reel" + i);
    if (!reel) continue;
    
    reel.innerHTML = "";
    
    // Create 2 cycles of all animals (for seamless looping)
    for(let cycle = 0; cycle < 2; cycle++) {
      animals.forEach(animal => {
        const img = document.createElement("img");
        img.src = `images/${animal}.png`;
        img.alt = animal;
        img.loading = "lazy";
        img.onerror = function(){
          this.src = `images/${animal.replace(/\s+/g,'')}.png`;
        };
        reel.appendChild(img);
      });
    }
    
    reel.style.top = "0px";
    reel.dataset.cycleHeight = reel.children.length * reelHeight;
  }
}

/* ---------------- SINGLE SLOT ---------------- */
function collapseToSingleSlot(animal){
  const reels = document.getElementById("reels");
  reels.style.opacity = "0.5";
  
  setTimeout(() => {
    reels.innerHTML = "";
    
    const container = document.createElement("div");
    container.className = 'reel-container single';
    
    const img = document.createElement("img");
    img.className = 'single-photo';
    img.src = `images/${animal}.png`;
    img.alt = `${animal} zodiac sign`;
    img.loading = "lazy";
    img.onerror = function(){
      this.src = `images/${animal.replace(/\s+/g,'')}.png`;
    };
    
    const overlay = document.createElement("img");
    overlay.className = 'overlay';
    overlay.src = 'images/overlay.png';
    overlay.alt = "Slot machine overlay";
    
    container.appendChild(img);
    container.appendChild(overlay);
    reels.appendChild(container);
    
    reels.style.opacity = "1";
    document.querySelector('.tabs-wrapper').classList.add('active');
    resultsShown = true; // Mark that results are now shown
    
    // SET TIMER TO STOP FIREWORKS AFTER 4 SECONDS
    setTimeout(() => {
      fireworks.stop();
    }, 4000);
    
    // Scroll to tabs on mobile
    if (window.innerWidth < 768) {
      setTimeout(() => {
        document.querySelector('.tabs-wrapper').scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }, 500);
    }
  }, 400);
}

/* ---------------- SPIN FUNCTION WITH FAST FIREWORKS ---------------- */
function startSpin(){
  if (isSpinning) return;
  isSpinning = true;
  
  // Disable button during spin
  const spinButton = document.getElementById("spinButton");
  spinButton.disabled = true;
  spinButton.style.opacity = "0.7";
  spinButton.innerHTML = '<span class="gold">Spinning...</span>';
  
  // START FAST FIREWORKS WITH HEARTS AND STARS!
  fireworks.start();
  
  const reelsDiv = document.getElementById("reels");
  
  // Reset to three reels if showing single
  if (!document.getElementById("reel1") && originalReelsHTML) {
    reelsDiv.innerHTML = originalReelsHTML;
    initReels();
  }
  
  const {animal, element, year} = getUserZodiacFromDropdown();
  
  const reels = [
    document.getElementById("reel1"),
    document.getElementById("reel2"),
    document.getElementById("reel3")
  ].filter(reel => reel !== null);
  
  const targetIndex = animals.indexOf(animal);
  const spinDurations = [1800, 2400, 3000];
  let completedSpins = 0;
  
  reels.forEach((reel, i) => {
    if (!reel) return;
    
    const startTime = Date.now();
    const cycleHeight = parseInt(reel.dataset.cycleHeight) || 2400;
    const step = 14;
    const tickMs = 16;
    
    reel.style.transition = 'none';
    
    const interval = setInterval(() => {
      let top = parseFloat(reel.style.top) || 0;
      top -= step;
      
      if (Math.abs(top) >= cycleHeight / 2) {
        top += cycleHeight / 2;
      }
      
      reel.style.top = top + 'px';
      
      if (Date.now() - startTime >= spinDurations[i]) {
        clearInterval(interval);
        
        const imgCount = animals.length;
        const containerHeight = reel.parentElement.offsetHeight;
        reel.style.transition = 'top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
        reel.style.top = -(targetIndex + imgCount) * containerHeight + 'px';
        
        completedSpins++;
        
        if (completedSpins === reels.length) {
          const onSettled = function(e) {
            if (e.propertyName !== 'top') return;
            reel.removeEventListener('transitionend', onSettled);
            
            // Generate and display all tab content
            generateZodiacText(animal, element, year);
            collapseToSingleSlot(animal);
            
            // Re-enable button
            setTimeout(() => {
              spinButton.disabled = false;
              spinButton.style.opacity = "1";
              spinButton.innerHTML = '<span class="gold">Discover My Zodiac!</span>';
              isSpinning = false;
            }, 500);
          };
          
          reel.addEventListener('transitionend', onSettled);
        }
      }
    }, tickMs);
  });
}

/* ---------------- INITIALIZATION ---------------- */
window.addEventListener('DOMContentLoaded', function() {
  initBirthdayDropdowns();
  initReels();
  originalReelsHTML = document.getElementById("reels").innerHTML;
  
  // Handle window resize
  let resizeTimeout;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      if (document.getElementById("reel1")) {
        initReels();
      }
    }, 250);
  });
  
  // Touch device optimizations
  const spinButton = document.getElementById('spinButton');
  
  spinButton.addEventListener('touchstart', function() {
    this.style.transform = 'translateY(4px)';
  });
  
  spinButton.addEventListener('touchend', function() {
    this.style.transform = '';
  });
  
  // Add keyboard support for dropdowns
  document.querySelectorAll('select').forEach(select => {
    select.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        startSpin();
      }
    });
  });
  
  // Enter key support for the page
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !isSpinning) {
      startSpin();
    }
  });
});
</script>
</body>
</html>
