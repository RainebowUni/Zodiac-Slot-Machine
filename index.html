<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chinese Zodiac Slot Machine</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css?family=Rubik:700&display=swap" rel="stylesheet">

<!-- Canvas Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<style>
body {
  text-align:center;
  font-family:sans-serif;
  background:#FFD6D7;
  color:#fff;
  margin:0;
  padding:0;
}

/* Birthday dropdowns */
select {
  padding:10px;
  font-size:16px;
  margin:5px;
}

/* Spin button */
#spinButton {
  font-family: 'Rubik', sans-serif;
  font-weight: 700;
  background: #b12424;
  color: #ffffff;
  border: 2px solid #000000;
  padding: 12px 25px;
  font-size: 18px;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 4px 6px #ca3434;
  transition: all 0.2s ease-in-out;
}
#spinButton:hover {
  background: #bd3c3c;
  box-shadow: 0 6px 8px #be3838;
  transform: translateY(-2px);
}

/* APNG title auto-size */
#title-img {
  width: 90vw;      /* 90% of viewport width */
  max-width: 600px; /* max size for desktop */
  height: auto;
  margin-top: 20px;
}

/* Reels */
#reels {
  display:flex;
  justify-content:center;
  margin-top:40px;
}
.reel-container {
  width:100px;
  height:100px;
  overflow:hidden;
  border:4px solid #fff;
  margin:0 10px;
  position:relative;
  border-radius:8px;
  box-shadow: 0 0 10px #fff;
  animation: glow 2s infinite alternate;
}
@keyframes glow {
  0% { box-shadow: 0 0 10px #fff; }
  50% { box-shadow: 0 0 20px #be3838, 0 0 30px #be3838; }
  100% { box-shadow: 0 0 10px #fff; }
}
.reel {
  display:flex;
  flex-direction:column;
  position:absolute;
  top:0;
}
.reel img {
  width:100px;
  height:100px;
  object-fit:contain;
}

/* Overlay */
.overlay {
  position:absolute;
  top:-5px;
  left:-5px;
  width:110%;
  height:110%;
  pointer-events:none;
  z-index:10;
}

/* Zodiac details */
#details {
  margin-top:30px;
  font-family:'Rubik', sans-serif;
  font-size:18px;
  color:#382b22;
  max-width:350px;
  margin-left:auto;
  margin-right:auto;
  text-align:left;
  white-space:pre-wrap;
}
</style>
</head>
<body>

<!-- APNG title -->
<img id="title-img" src="images/title.apng" alt="Chinese Zodiac Slot Machine">

<br><br>

<!-- Birthday dropdowns -->
<select id="month"></select>
<select id="day"></select>
<select id="year"></select>
<br><br><br>

<!-- Spin button -->
<button id="spinButton" onclick="startSpin()">Get My Zodiac!</button>
<br><br>

<!-- Reels -->
<div id="reels">
  <div class="reel-container">
    <div class="reel" id="reel1"></div>
    <img src="images/overlay.png" class="overlay">
  </div>
  <div class="reel-container">
    <div class="reel" id="reel2"></div>
    <img src="images/overlay.png" class="overlay">
  </div>
  <div class="reel-container">
    <div class="reel" id="reel3"></div>
    <img src="images/overlay.png" class="overlay">
  </div>
</div>

<div id="details"></div>

<script>
// ------------------ DATA ------------------
const animals = ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"];
const elements = ["Wood","Fire","Earth","Metal","Water"];
const zodiacYears = {
"Rat": { "Wood":[1924,1984,2044], "Fire":[1936,1996,2056], "Earth":[1948,2008,2068], "Metal":[1960,2020,2080], "Water":[1912,1972,2032] },
"Ox": { "Wood":[1925,1985,2045], "Fire":[1937,1997,2057], "Earth":[1949,2009,2069], "Metal":[1961,2021,2081], "Water":[1913,1973,2033] },
"Tiger": { "Wood":[1926,1986,2046], "Fire":[1938,1998,2058], "Earth":[1950,2010,2070], "Metal":[1962,2022,2082], "Water":[1914,1974,2034] },
"Rabbit": { "Wood":[1927,1987,2047], "Fire":[1939,1999,2059], "Earth":[1951,2011,2071], "Metal":[1963,2023,2083], "Water":[1915,1975,2035] },
"Dragon": { "Wood":[1928,1988,2048], "Fire":[1940,2000,2060], "Earth":[1952,2012,2072], "Metal":[1964,2024,2084], "Water":[1916,1976,2036] },
"Snake": { "Wood":[1929,1989,2049], "Fire":[1941,2001,2061], "Earth":[1953,2013,2073], "Metal":[1965,2025,2085], "Water":[1917,1977,2037] },
"Horse": { "Wood":[1930,1990,2050], "Fire":[1942,2002,2062], "Earth":[1954,2014,2074], "Metal":[1966,2026,2086], "Water":[1918,1978,2038] },
"Goat": { "Wood":[1931,1991,2051], "Fire":[1943,2003,2063], "Earth":[1955,2015,2075], "Metal":[1967,2027,2087], "Water":[1919,1979,2039] },
"Monkey": { "Wood":[1932,1992,2052], "Fire":[1944,2004,2064], "Earth":[1956,2016,2076], "Metal":[1968,2028,2088], "Water":[1920,1980,2040] },
"Rooster": { "Wood":[1933,1993,2053], "Fire":[1945,2005,2065], "Earth":[1957,2017,2077], "Metal":[1969,2029,2089], "Water":[1921,1981,2041] },
"Dog": { "Wood":[1934,1994,2054], "Fire":[1946,2006,2066], "Earth":[1958,2018,2078], "Metal":[1970,2030,2090], "Water":[1922,1982,2042] },
"Pig": { "Wood":[1935,1995,2055], "Fire":[1947,2007,2067], "Earth":[1959,2019,2079], "Metal":[1971,2031,2091], "Water":[1923,1983,2043] }
};

// ------------------ FUNCTIONS ------------------
function initBirthdayDropdowns(){
  const monthSelect = document.getElementById("month");
  const daySelect = document.getElementById("day");
  const yearSelect = document.getElementById("year");
  const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  monthNames.forEach((m,i)=> monthSelect.add(new Option(m,i+1)));
  for(let d=1; d<=31; d++) daySelect.add(new Option(d,d));
  const currentYear = new Date().getFullYear();
  const minYear = currentYear - 100;
  for(let y=minYear; y<=currentYear; y++) yearSelect.add(new Option(y,y));
}

function getUserZodiacFromDropdown(){
  const year = parseInt(document.getElementById("year").value);
  const animal = animals[(year - 4) % 12];
  const element = elements[Math.floor(((year - 4) % 10)/2)];
  return {animal, element, year};
}

function generateZodiacText(animal, element, year){
  let text = `Your Zodiac: ${element} ${animal} (${year})\n\nOther years by element:\n`;
  const years = zodiacYears[animal];
  for(const el of elements){
    text += `${el}: ${years[el].join(', ')}\n`;
  }
  return text;
}

function initReels(){
  for(let i=1;i<=3;i++){
    const reelDiv = document.getElementById("reel"+i);
    reelDiv.innerHTML = "";
    for(let j=0;j<2;j++){
      for(const animal of animals){
        const img = document.createElement("img");
        img.src = `images/${animal}.png`;
        reelDiv.appendChild(img);
      }
    }
    reelDiv.style.top = "0px";
  }
}

// ------------------ CONFETTI ------------------
function fireConfetti() {
  var count = 800;
  var defaults = {
  origin: { y: 0.6 },
  spread: 460,
  ticks: 50,
  gravity: -1,
  decay: 0.94,
  startVelocity: 40,
    colors: ['#CC232A', '#FFD84B', '#F2888B', '#A3262A', '#CC9902', '#00A36C', '#F5AC27']
  };

  // Function to fire individual bursts
  function fire(particleRatio, opts) {
    confetti({
      ...defaults,
      ...opts,
      particleCount: Math.floor(count * particleRatio)
    });
  }

  // Fire bursts from first code
  fire(0.25, { spread: 26, startVelocity: 55 });
  fire(0.2, { spread: 60 });
  fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
  fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
  fire(0.1, { spread: 120, startVelocity: 45 });

  // Star and circle bursts from second code
  function shoot() {
    confetti({
      ...defaults,
      particleCount: 40,
      scalar: 1.2,
      shapes: ['star']
    });

    confetti({
      ...defaults,
      particleCount: 10,
      scalar: 0.75,
      shapes: ['circle']
    });
  }

  setTimeout(shoot, 0);
  setTimeout(shoot, 100);
  setTimeout(shoot, 200);
}


// ------------------ SPIN ------------------
function startSpin(){
  fireConfetti(); // fire confetti on button press
  
  const {animal, element, year} = getUserZodiacFromDropdown();
  const reels = [document.getElementById("reel1"), document.getElementById("reel2"), document.getElementById("reel3")];
  const targetIndex = animals.indexOf(animal);
  const spinDurations = [2000,2500,3000];
  
  reels.forEach((reel,i)=>{
    const startTime = Date.now();
    const interval = setInterval(()=>{
      let currentTop = parseInt(reel.style.top)||0;
      currentTop -= 100;
      if(Math.abs(currentTop)>=12*100) currentTop = 0;
      reel.style.transition = "top 0.08s linear";
      reel.style.top = currentTop+"px";
      
      if(Date.now()-startTime>=spinDurations[i]){
        clearInterval(interval);
        reel.style.transition = "top 0.5s ease-out";
        reel.style.top = -(targetIndex*100)+"px";
        
        if(i===2){
          document.getElementById("details").innerText = generateZodiacText(animal, element, year);
        }
      }
    },80);
  });
}

// ------------------ INIT ------------------
initBirthdayDropdowns();
initReels();
</script>

</body>
</html>
