<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chinese Zodiac Slot Machine</title>
<style>
/* ------------------ FONT ------------------ */
@import url('https://fonts.googleapis.com/css?family=Rubik:700&display=swap');

/* ------------------ BODY ------------------ */
body {
  text-align:center;
  font-family:sans-serif;
  background:#FFD6D7;
  color:#fff;
  margin:0;
  padding:0;
}

/* ------------------ BIRTHDAY DROPDOWNS ------------------ */
select {
  padding:1vw;
  font-size:4vw;
  margin:1vw;
  max-width:90%;
}

/* ------------------ SPIN BUTTON ------------------ */
#spinButton {
  font-family: 'Rubik', sans-serif;
  font-weight: 700;
  background: #b12424;
  color: #ffffff;
  border: 2px solid #000000;
  padding: 2vw 5vw;
  font-size: 5vw;
  border-radius: 1vw;
  cursor: pointer;
  box-shadow: 0 0.5vw 1vw #ca3434;
  transition: all 0.2s ease-in-out;
}

#spinButton:hover {
  background: #bd3c3c;
  box-shadow: 0 0.8vw 1vw #be3838;
  transform: translateY(-0.5vw);
}

/* ------------------ APNG TITLE ------------------ */
#title-img {
  width: 90%;
  max-width: 600px;
  height: auto;
  margin: 2vw auto;
  display:block;
}

/* ------------------ REELS ------------------ */
#reels {
  display:flex;
  justify-content:center;
  align-items:center;
  margin-top:5vw;
  flex-wrap: wrap;
  gap:2vw; /* spacing for small screens */
}

.reel-container {
  width: 25vw;
  max-width: 120px;
  height: 25vw;
  max-height: 120px;
  overflow:hidden;
  border:0.5vw solid #fff;
  position:relative;
  border-radius:1vw;
  box-shadow: 0 0 1vw #fff;
  animation: glow 2s infinite alternate;
}

@keyframes glow {
  0% { box-shadow: 0 0 0.5vw #fff; }
  50% { box-shadow: 0 0 1vw #be3838, 0 0 1.5vw #be3838; }
  100% { box-shadow: 0 0 0.5vw #fff; }
}

.reel {
  display:flex;
  flex-direction:column;
  position:absolute;
  top:0;
}

.reel img {
  width:100%;
  height:100%;
  object-fit:contain;
}

/* ------------------ OVERLAY ------------------ */
.overlay {
  position:absolute;
  top:-5%;
  left:-5%;
  width:110%;
  height:110%;
  pointer-events:none;
  z-index:10;
}

/* ------------------ DETAILS ------------------ */
#details {
  margin-top:3vw;
  font-size:4vw;
  max-width:90%;
  margin-left:auto;
  margin-right:auto;
  text-align:left;
  white-space:pre-wrap;
}

/* ------------------ RESPONSIVE FIXES ------------------ */
@media (max-width: 400px) {
  #reels {
    gap:1vw;
  }
  .reel-container {
    width:30vw;
    height:30vw;
    max-width:none;
    max-height:none;
  }
  #spinButton {
    font-size:6vw;
    padding:3vw 6vw;
  }
  select {
    font-size:5vw;
    padding:2vw;
  }
  #details {
    font-size:5vw;
  }
}
</style>
</head>
<body>

<!-- APNG title -->
<img id="title-img" src="images/title.apng" alt="Chinese Zodiac Slot Machine">

<!-- Birthday dropdowns -->
<select id="month"></select>
<select id="day"></select>
<select id="year"></select>
<br>

<!-- Styled spin button -->
<button id="spinButton" onclick="startSpin()">Get My Zodiac!</button>

<!-- Reels with overlay per reel -->
<div id="reels">
  <div class="reel-container">
    <div class="reel" id="reel1"></div>
    <img src="images/overlay.png" class="overlay">
  </div>
  <div class="reel-container">
    <div class="reel" id="reel2"></div>
    <img src="images/overlay.png" class="overlay">
  </div>
  <div class="reel-container">
    <div class="reel" id="reel3"></div>
    <img src="images/overlay.png" class="overlay">
  </div>
</div>

<div id="details"></div>

<script>
// ------------------ DATA ------------------
const animals = ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"];
const elements = ["Wood","Fire","Earth","Metal","Water"];
const zodiacYears = {
  "Rat": { "Wood":[1924,1984], "Fire":[1936,1996], "Earth":[1948,2008], "Metal":[1960,2020], "Water":[1972] },
  "Ox": { "Wood":[1925,1985], "Fire":[1937,1997], "Earth":[1949,2009], "Metal":[1961,2021], "Water":[1973] },
  "Tiger": { "Wood":[1926,1986], "Fire":[1938,1998], "Earth":[1950,2010], "Metal":[1962,2022], "Water":[1974] },
  "Rabbit": { "Wood":[1927,1987], "Fire":[1939,1999], "Earth":[1951,2011], "Metal":[1963,2023], "Water":[1975] },
  "Dragon": { "Wood":[1928,1988], "Fire":[1940,2000], "Earth":[1952,2012], "Metal":[1964,2024], "Water":[1976] },
  "Snake": { "Wood":[1929,1989], "Fire":[1941,2001], "Earth":[1953,2013], "Metal":[1965,2025], "Water":[1977] },
  "Horse": { "Wood":[1930,1990], "Fire":[1942,2002], "Earth":[1954,2014], "Metal":[1966,2026], "Water":[1978] },
  "Goat": { "Wood":[1931,1991], "Fire":[1943,2003], "Earth":[1955,2015], "Metal":[1967,2027], "Water":[1979] },
  "Monkey": { "Wood":[1932,1992], "Fire":[1944,2004], "Earth":[1956,2016], "Metal":[1968,2028], "Water":[1980] },
  "Rooster": { "Wood":[1933,1993], "Fire":[1945,2005], "Earth":[1957,2017], "Metal":[1969,2029], "Water":[1981] },
  "Dog": { "Wood":[1934,1994], "Fire":[1946,2006], "Earth":[1958,2018], "Metal":[1970,2030], "Water":[1982] },
  "Pig": { "Wood":[1935,1995], "Fire":[1947,2007], "Earth":[1959,2019], "Metal":[1971,2031], "Water":[1983] },
};

// ------------------ FUNCTIONS ------------------
function initBirthdayDropdowns(){
  const monthSelect = document.getElementById("month");
  const daySelect = document.getElementById("day");
  const yearSelect = document.getElementById("year");
  const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  monthNames.forEach((m,i)=> monthSelect.add(new Option(m,i+1)));
  for(let d=1; d<=31; d++) daySelect.add(new Option(d,d));
  const currentYear = new Date().getFullYear();
  const minYear = currentYear - 80;
  for(let y=minYear; y<=currentYear; y++) yearSelect.add(new Option(y,y));
}

function getUserZodiacFromDropdown(){
  const year = parseInt(document.getElementById("year").value);
  const animal = animals[(year - 4) % 12];
  const element = elements[Math.floor(((year - 4) % 10)/2)];
  return {animal, element, year};
}

function generateZodiacText(animal, element, year){
  let text = `Your Zodiac: ${element} ${animal} (${year})\n\n`;
  text += "Other years for this animal by element:\n";
  const years = zodiacYears[animal];
  for(const el of elements){
    if(years[el]) text += `${el}: ${years[el].join(', ')}\n`;
  }
  return text;
}

function initReels(){
  for(let i=1;i<=3;i++){
    const reelDiv = document.getElementById("reel"+i);
    reelDiv.innerHTML = "";
    for(let j=0;j<2;j++){
      for(const animal of animals){
        const img = document.createElement("img");
        img.src = `images/${animal}.png`;
        reelDiv.appendChild(img);
      }
    }
    reelDiv.style.top = "0px";
  }
}

function startSpin(){
  const {animal, element, year} = getUserZodiacFromDropdown();
  const reels = [document.getElementById("reel1"), document.getElementById("reel2"), document.getElementById("reel3")];
  const targetIndex = animals.indexOf(animal);
  const spinDurations = [2000, 2500, 3000];

  reels.forEach((reel,i)=>{
    const startTime = Date.now();
    const interval = setInterval(()=>{
      let currentTop = parseInt(reel.style.top) || 0;
      currentTop -= 100;
      if(Math.abs(currentTop) >= 12*100) currentTop = 0;
      reel.style.transition = "top 0.08s linear";
      reel.style.top = currentTop + "px";

      if(Date.now() - startTime >= spinDurations[i]){
        clearInterval(interval);
        reel.style.transition = "top 0.5s ease-out";
        reel.style.top = -(targetIndex*100) + "px";

        if(i===2){
          document.getElementById("details").innerText = generateZodiacText(animal, element, year);
        }
      }
    },80);
  });
}

// ------------------ INIT ------------------
initBirthdayDropdowns();
initReels();
</script>

</body>
</html>
