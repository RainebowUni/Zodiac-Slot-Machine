<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chinese Zodiac Slot Machine</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css?family=Rubik:700&family=Allura&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Diphylleia&display=swap" rel="stylesheet">

<style>
/* === STYLING === */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 16px;
  overflow-x: hidden;
}

body {
  text-align: center;
  font-family: "Diphylleia", serif;
  background: #ffe6e9;
  background-attachment: fixed;
  color: #fff;
  min-height: 100vh;
  padding: 10px;
  overflow-x: hidden;
  position: relative;
  width: 100%;
  max-width: 100%;
}

#fireworksCanvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
  display: none;
  background-color: transparent !important;
}

body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.1) 1px, transparent 1px),
    radial-gradient(circle at 90% 80%, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
  background-size: 50px 50px;
  z-index: -1;
  pointer-events: none;
}

.main-container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  position: relative;
  overflow: hidden;
  padding: max(10px, 2vw);
  background: rgba(255, 255, 255, 0.1);
  border-radius: clamp(15px, 2vw, 20px);
  border: max(4px, 0.5vw) double gold;
  box-shadow: 
    0 0 30px rgba(190, 56, 56, 0.5),
    inset 0 0 30px rgba(255, 255, 255, 0.2);
  z-index: 10;
}

.sakura-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  border-radius: inherit;
}

.cloud-decoration {
  display: none;
}

#title-img {
  display: block;
  width: min(95%, 600px);
  height: auto;
  margin: 0 auto max(15px, 2vw) auto;
  max-width: 100%;
  filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
}

.chinese-title {
  display: none;
}

.lanterns-container {
  width: 100%;
  position: relative;
  margin: max(15px, 2vw) 0 max(30px, 3vw) 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.lanterns-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  padding: 0 clamp(10px, 3vw, 30px);
  gap: clamp(10px, 3vw, 40px);
}

.lantern-left-container,
.lantern-right-container {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}

.lantern {
  width: clamp(50px, 10vw, 100px);
  height: auto;
  aspect-ratio: 100/170;
  transform-origin: top center;
  animation: sway-left 5.5s ease-in-out infinite;
  flex-shrink: 0;
  filter: drop-shadow(0 10px 20px rgba(255, 215, 0, 0.5));
}

.lantern-right-container .lantern {
  animation: sway-right 5.5s ease-in-out infinite;
}

@keyframes sway-left { 
  0% { transform: rotate(-8deg); }
  50% { transform: rotate(8deg); }
  100% { transform: rotate(-8deg); } 
}

@keyframes sway-right { 
  0% { transform: rotate(8deg); }
  50% { transform: rotate(-8deg); }
  100% { transform: rotate(8deg); } 
}

.content-wrapper {
  flex: 1;
  display: flex;
  justify-content: center;
  min-width: min(300px, 80vw);
  max-width: min(400px, 90vw);
  padding: 0 clamp(10px, 2vw, 20px);
  position: relative;
  z-index: 2;
}

.content-box {
  width: 100%;
  background: rgba(255, 255, 255, 0.9);
  padding: clamp(15px, 2vw, 25px);
  border-radius: clamp(10px, 1.5vw, 15px);
  border: clamp(2px, 0.3vw, 3px) solid #be3838;
  box-shadow: 
    0 10px 30px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(255, 215, 0, 0.2);
}

.dropdown-button-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: clamp(15px, 2vw, 25px);
  width: 100%;
}

.dropdowns {
  display: flex;
  gap: clamp(5px, 1vw, 10px);
  justify-content: center;
  flex-wrap: wrap;
  width: 100%;
}

select {
  padding: clamp(10px, 1vw, 14px) clamp(12px, 1vw, 16px);
  font-size: clamp(0.9rem, 1.1vw, 1.1rem);
  border: clamp(1px, 0.2vw, 2px) solid #be3838;
  border-radius: clamp(6px, 0.8vw, 8px);
  background: white;
  color: #333;
  min-width: clamp(80px, 9vw, 110px);
  cursor: pointer;
  font-family: "Diphylleia", serif;
  transition: all 0.3s ease;
  flex: 1;
  max-width: clamp(100px, 10vw, 130px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  position: relative;
}

select:focus {
  outline: none;
  box-shadow: 0 0 0 4px rgba(190, 56, 56, 0.3);
  border-color: #ff3333;
}

#spinButton {
  position: relative;
  font-family: "Diphylleia", serif;
  font-weight: 600;
  color: #382b22;
  text-transform: uppercase;
  padding: clamp(15px, 1.5vw, 22px) clamp(25px, 2.5vw, 40px);
  background: linear-gradient(145deg, #be3838, #972525);
  border: clamp(2px, 0.3vw, 3px) solid #000;
  border-radius: clamp(10px, 1vw, 15px);
  cursor: pointer;
  outline: 2px solid transparent;
  transform-style: preserve-3d;
  transition: all 0.2s ease;
  font-size: clamp(1.1rem, 1.5vw, 1.5rem);
  width: 100%;
  max-width: min(350px, 90vw);
  display: block;
  margin: 0 auto;
  box-shadow: 
    0 10px 20px rgba(0, 0, 0, 0.3),
    inset 0 2px 0 rgba(255, 255, 255, 0.4);
  overflow: hidden;
}

#spinButton::before {
  content: '';
  position: absolute; 
  width: 100%; 
  height: 100%; 
  top: 0; 
  left: 0;
  background: linear-gradient(145deg, #972525, #6a1a1a); 
  border-radius: inherit;
  transform: translate3d(0, 12px, -12px);
  transition: all 0.2s ease;
  z-index: -1;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

#spinButton:hover { 
  background: linear-gradient(145deg, #972525, #be3838); 
  transform: translateY(6px); 
}

#spinButton:hover::before { 
  transform: translate3d(0, 6px, -12px);
}

#spinButton:active { 
  background: linear-gradient(145deg, #6a1a1a, #972525); 
  transform: translateY(12px); 
}

#spinButton:active::before { 
  transform: translate3d(0, 0, -12px);
}

#spinButton .gold {
  display: inline-block;
  position: relative;
  font-weight: 600;
  text-transform: uppercase;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(90deg, #daa520 0%, #e8b923 25%, #ffde22 50%, #ffd700 75%, #b8860b 100%);
  background-size: 200% 100%;
  animation: goldShift 3s linear infinite;
  letter-spacing: 2px;
  z-index: 1;
  font-size: clamp(1.2rem, 1.8vw, 1.8rem);
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

@keyframes goldShift { 
  0% { background-position: 0% 50%; }
  100% { background-position: 200% 50%; } 
}

.reels-section {
  margin: clamp(30px, 5vw, 50px) auto;
  width: 100%;
  position: relative;
}

#reels {
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 300ms ease;
  gap: clamp(15px, 2vw, 25px);
  padding: 0 clamp(15px, 2vw, 20px);
  max-width: 100%;
  flex-wrap: wrap;
  position: relative;
  z-index: 2;
}

.reel-container {
  width: clamp(100px, 15vw, 150px);
  height: clamp(100px, 15vw, 150px);
  overflow: hidden;
  background: white;
  border: clamp(3px, 0.5vw, 5px) solid #be3838;
  position: relative;
  border-radius: clamp(15px, 2vw, 20px);
  box-shadow: 
    0 0 30px #fff,
    0 0 60px rgba(190, 56, 56, 0.8),
    inset 0 0 20px rgba(255, 215, 0, 0.3);
  animation: glow 2s infinite alternate;
  flex-shrink: 0;
}

@keyframes glow {
  0% { 
    box-shadow: 0 0 20px #fff, 
                0 0 40px rgba(190, 56, 56, 0.5),
                inset 0 0 10px rgba(255, 215, 0, 0.2); 
  }
  50% { 
    box-shadow: 0 0 40px #be3838, 
                0 0 80px rgba(175, 36, 36, 0.9),
                inset 0 0 30px rgba(255, 215, 0, 0.5); 
  }
  100% { 
    box-shadow: 0 0 20px #fff, 
                0 0 40px rgba(254, 230, 233, 0.5),
                inset 0 0 10px rgba(255, 215, 0, 0.2); 
  }
}

.reel {
  display: flex;
  flex-direction: column;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
}

.reel img {
  width: 100%;
  height: clamp(100px, 15vw, 150px);
  object-fit: contain;
  display: block;
  padding: clamp(5px, 1vw, 10px);
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 10;
  object-fit: cover;
  border-radius: clamp(10px, 1.5vw, 15px);
}

.reel-container.single {
  width: clamp(200px, 30vw, 300px);
  height: clamp(200px, 30vw, 300px);
  margin: 0 auto;
}

.reel-container.single img.single-photo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: clamp(10px, 1.5vw, 15px);
}

.tabs-wrapper {
  display: none;
  margin-top: clamp(25px, 4vw, 40px);
  width: 100%;
}

.tabs-wrapper.active {
  display: block;
}

.wrapper {
  width: min(95%, 600px);
  margin: clamp(25px, 4vw, 40px) auto;
  padding: 0 clamp(15px, 2vw, 20px);
  position: relative;
}

.tabs-section [type="radio"] {
  display: none;
}

.tabs-section {
  position: relative;
  overflow-x: hidden;
  padding-bottom: 5px;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: clamp(3px, 0.5vw, 5px);
}

.tabs-section label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: clamp(12px, 1vw, 16px) clamp(20px, 1.5vw, 25px);
  background: linear-gradient(to bottom, #972525, #be3838);
  color: #FFD700;
  cursor: pointer;
  font-weight: bold;
  border-radius: clamp(8px, 1vw, 10px) clamp(8px, 1vw, 10px) 0 0;
  position: relative;
  border: clamp(1px, 0.2vw, 2px) solid #000;
  border-bottom: none;
  white-space: nowrap;
  font-size: clamp(0.9rem, 1.1vw, 1.1rem);
  z-index: 2;
  transition: all 0.3s ease;
  min-width: clamp(110px, 9vw, 140px);
  flex-shrink: 0;
  font-family: "Diphylleia", serif;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.tabs-section label span {
  position: relative;
  z-index: 3;
}

.tabs-section label::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: clamp(6px, 0.8vw, 8px) clamp(6px, 0.8vw, 8px) 0 0;
  background: linear-gradient(to bottom, #be3838, #972525);
  border: clamp(1px, 0.2vw, 2px) solid #000;
  border-bottom: none;
  transform: perspective(120px) rotateX(20deg);
  z-index: 1;
}

.tabs-section [type="radio"]:checked + label {
  background: white !important;
  color: #be3838 !important;
}

.tabs-section [type="radio"]:checked + label::after {
  background: white !important;
  z-index: 2;
}

.tabs-section [type="radio"]:checked + label span {
  color: #be3838;
  z-index: 3;
  font-weight: bold;
}

.tabs-content {
  position: relative;
  border: clamp(2px, 0.3vw, 3px) solid #000;
  border-radius: 0 0 clamp(8px, 1vw, 10px) clamp(8px, 1vw, 10px);
  background: white;
  color: #000;
  padding: clamp(20px, 2.5vw, 30px);
  min-height: min(200px, 50vh);
  max-height: 500px;
  overflow-y: auto;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  margin-top: -4px;
  z-index: 1;
  box-shadow: 
    0 10px 30px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(190, 56, 56, 0.1);
  font-family: "Diphylleia", serif;
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  white-space: normal !important;
}

.tabs-content section {
  display: none;
  width: 100%;
  word-wrap: break-word;
  overflow-wrap: break-word;
  word-break: break-word;
  white-space: normal !important;
}

.tabs-content * {
  white-space: normal !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  word-break: break-word !important;
  max-width: 100%;
}

#tab1:checked ~ .tabs-content #general,
#tab2:checked ~ .tabs-content #story,
#tab3:checked ~ .tabs-content #elements,
#tab4:checked ~ .tabs-content #famous {
  display: block;
}

.tabs-content::-webkit-scrollbar {
  width: 12px;
}

.tabs-content::-webkit-scrollbar-track {
  background: #fff;
  border-radius: 6px;
  border: 2px solid #be3838;
}

.tabs-content::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #be3838, #972525);
  border-radius: 6px;
  border: 2px solid #fff;
}

.tabs-content {
  scrollbar-width: thin;
  scrollbar-color: #be3838 #fff;
}

.new-year-message {
  font-family: "Diphylleia", serif;
  font-size: clamp(0.9rem, 1.2vw, 1.2rem);
  color: rgb(255, 255, 255);
  text-align: center;
  margin: clamp(20px, 3vw, 30px) 0 clamp(10px, 1.5vw, 10px) 0;
  padding: clamp(8px, 1vw, 10px);
  background: #be3838;
  border-radius: clamp(8px, 1vw, 10px);
  border: clamp(1px, 0.2vw, 2px) solid gold;
  text-shadow: 1px 1px 2px gold;
}

.chinese-char {
  font-family: "Diphylleia", serif;
  font-size: 1.2em;
  margin: 0 3px;
}

.lucky-section {
  background: #ffe6e9;
  padding: clamp(10px, 1vw, 15px);
  border-radius: clamp(8px, 1vw, 10px);
  margin: clamp(10px, 1vw, 15px) 0;
  border-left: clamp(3px, 0.4vw, 4px) solid #be3838;
}

@media screen and (max-width: 768px) {
  html {
    font-size: 14px;
  }
  .lanterns-wrapper {
    flex-wrap: nowrap;
  }
  .dropdowns {
    gap: 8px;
  }
  select {
    min-width: 85px;
    max-width: 100px;
  }
}

@media screen and (max-width: 480px) {
  html {
    font-size: 13px;
  }
  .lanterns-wrapper {
    gap: 8px;
    padding: 0 5px;
  }
  .lantern {
    animation-duration: 4s;
  }
  .dropdowns {
    gap: 5px;
  }
  select {
    min-width: 75px;
    padding: 8px 10px;
    font-size: 0.9rem;
  }
  #spinButton {
    padding: 12px 20px;
    font-size: 1rem;
  }
  #spinButton .gold {
    font-size: 1.2rem;
  }
  #reels {
    gap: 10px;
  }
  .reel-container {
    width: 90px;
    height: 90px;
  }
  .reel img {
    height: 90px;
  }
  .tabs-section {
    gap: 2px;
  }
  .tabs-section label {
    min-width: 90px;
    padding: 8px 12px;
    font-size: 0.85rem;
  }
  .tabs-content {
    padding: 15px;
  }
  .new-year-message {
    font-size: 0.9rem;
    margin: 15px 0 8px 0;
    padding: 6px;
  }
}

@media screen and (max-width: 320px) {
  .lanterns-wrapper {
    gap: 5px;
  }
  .lantern {
    width: 40px;
  }
  .dropdowns {
    flex-direction: column;
    align-items: center;
  }
  select {
    min-width: 90%;
    max-width: 90%;
  }
  #reels {
    gap: 8px;
  }
  .reel-container {
    width: 80px;
    height: 80px;
  }
  .reel img {
    height: 80px;
  }
}

@media screen and (min-width: 1200px) {
  .main-container {
    max-width: 1400px;
  }
  .lantern {
    width: 110px;
  }
  .content-wrapper {
    max-width: 450px;
  }
  .reel-container {
    width: 170px;
    height: 170px;
  }
  .reel img {
    height: 170px;
  }
}
</style>
</head>
<body>

<canvas id="fireworksCanvas"></canvas>

<div class="main-container">

  <canvas id="sakuraCanvas" class="sakura-canvas"></canvas>

  <img id="title-img" src="images/title.apng" alt="Chinese Zodiac Slot Machine">

  <div class="lanterns-container">
    <div class="lanterns-wrapper">
      <div class="lantern-left-container">
        <img src="images/Lantern.png" class="lantern" alt="Lantern">
      </div>
      
      <div class="content-wrapper">
        <div class="content-box">
          <div class="dropdown-button-column">
            <div class="dropdowns">
              <select id="month" aria-label="Birth month"></select>
              <select id="day" aria-label="Birth day"></select>
              <select id="year" aria-label="Birth year"></select>
            </div>
            <button id="spinButton" onclick="startSpin()" aria-label="Get my zodiac sign">
              <span class="gold">Discover My Zodiac!</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="lantern-right-container">
        <img src="images/Lantern.png" class="lantern" alt="Lantern">
      </div>
    </div>
  </div>

  <div class="reels-section">
    <div id="reels">
      <div class="reel-container">
        <div class="reel" id="reel1"></div>
        <img src="images/overlay.png" class="overlay" alt="Slot overlay">
      </div>
      <div class="reel-container">
        <div class="reel" id="reel2"></div>
        <img src="images/overlay.png" class="overlay" alt="Slot overlay">
      </div>
      <div class="reel-container">
        <div class="reel" id="reel3"></div>
        <img src="images/overlay.png" class="overlay" alt="Slot overlay">
      </div>
    </div>
  </div>

  <div class="tabs-wrapper">
    <div class="wrapper">
      <section class="tabs-section">
        <input type="radio" name="tab" id="tab1" checked>
        <label for="tab1"><span>General Info</span></label>

        <input type="radio" name="tab" id="tab2">
        <label for="tab2"><span>Legend Story</span></label>

        <input type="radio" name="tab" id="tab3">
        <label for="tab3"><span>Elements & Years</span></label>

        <input type="radio" name="tab" id="tab4">
        <label for="tab4"><span>Famous People</span></label>

        <div class="tabs-content">
          <section id="general"></section>
          <section id="story"></section>
          <section id="elements"></section>
          <section id="famous"></section>
        </div>
      </section>
    </div>
  </div>

  <div class="new-year-message">
     G≈çng X«ê FƒÅ C√°i! ‚ù§Ô∏é Wishing You Prosperity! ‚ù§Ô∏é Xƒ´nni√°n Ku√†il√®! ‚ù§Ô∏é Happy New Year!
  </div>

</div>

<script>
// === üå∏ SAKURA PETALS - KEPT EXACTLY AS YOU WROTE IT üå∏ ===
const sakuraCanvas = document.getElementById('sakuraCanvas');
const sakCtx = sakuraCanvas.getContext('2d');

let containerWidth = 0;
let containerHeight = 0;
let petals = [];
let sakuraAnimationFrame = null;
let resizeTimeout = null;
let sakuraInitialized = false;

function initSakuraDimensions() {
  const container = document.querySelector('.main-container');
  if (!container) return false;
  
  const rect = container.getBoundingClientRect();
  if (rect.width === 0 || rect.height === 0) return false;
  
  if (containerWidth === rect.width && containerHeight === rect.height && sakuraInitialized) {
    return true;
  }
  
  containerWidth = rect.width;
  containerHeight = rect.height;
  
  const dpr = window.devicePixelRatio || 1;
  sakuraCanvas.width = containerWidth * dpr;
  sakuraCanvas.height = containerHeight * dpr;
  sakuraCanvas.style.width = containerWidth + 'px';
  sakuraCanvas.style.height = containerHeight + 'px';
  
  sakCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
  
  recreatePetals();
  sakuraInitialized = true;
  return true;
}

function recreatePetals() {
  petals = [];
  for (let i = 0; i < 60; i++) {
    petals.push({
      x: Math.random() * containerWidth,
      y: Math.random() * containerHeight,
      size: Math.random() * 14 + 7,
      speedY: Math.random() * 1.4 + 0.6,
      speedX: Math.random() * 0.4 - 0.2,
      spin: Math.random() * 0.03 - 0.015,
      angle: Math.random() * 360,
      opacity: Math.random() * 0.5 + 0.3,
      type: Math.floor(Math.random() * 3)
    });
  }
}

function drawSakuraInside() {
  if (!sakuraInitialized || !containerWidth || !containerHeight || containerWidth === 0 || containerHeight === 0) {
    const success = initSakuraDimensions();
    if (!success) {
      sakuraAnimationFrame = requestAnimationFrame(drawSakuraInside);
      return;
    }
  }
  
  sakCtx.clearRect(0, 0, containerWidth, containerHeight);
  
  petals.forEach(p => {
    sakCtx.save();
    sakCtx.translate(p.x, p.y);
    sakCtx.rotate(p.angle * Math.PI / 180);
    sakCtx.globalAlpha = p.opacity;
    
    const grad = sakCtx.createRadialGradient(0, 0, p.size*0.2, 0, 0, p.size*0.8);
    grad.addColorStop(0, '#FFE1F0');
    grad.addColorStop(0.6, '#FFB6C1');
    grad.addColorStop(1, '#FDA2AD');
    
    sakCtx.fillStyle = grad;
    sakCtx.shadowColor = 'rgba(90, 40, 40, 0.3)';
    sakCtx.shadowBlur = 7;
    sakCtx.shadowOffsetX = 1.2;
    sakCtx.shadowOffsetY = 1.2;
    
    if (p.type === 0) {
      for (let i=0; i<5; i++) {
        let angle = (i * 72) * Math.PI / 180;
        let px = Math.cos(angle) * p.size * 0.5;
        let py = Math.sin(angle) * p.size * 0.5;
        sakCtx.beginPath();
        sakCtx.ellipse(px, py, p.size*0.3, p.size*0.18, 0, 0, Math.PI*2);
        sakCtx.fill();
      }
      sakCtx.beginPath();
      sakCtx.arc(0, 0, p.size*0.14, 0, Math.PI*2);
      sakCtx.fillStyle = '#FFB7C5';
      sakCtx.fill();
    } else if (p.type === 1) {
      for (let i=0; i<5; i++) {
        let angle = (i*72) * Math.PI/180;
        sakCtx.save();
        sakCtx.rotate(angle);
        sakCtx.beginPath();
        sakCtx.moveTo(0, 0);
        sakCtx.quadraticCurveTo(p.size*0.4, -p.size*0.2, p.size*0.7, 0);
        sakCtx.quadraticCurveTo(p.size*0.4, p.size*0.2, 0, 0);
        sakCtx.fill();
        sakCtx.restore();
      }
    } else {
      for (let i=0; i<5; i++) {
        let angle = (i*72) * Math.PI/180;
        sakCtx.save();
        sakCtx.rotate(angle);
        sakCtx.beginPath();
        sakCtx.ellipse(p.size*0.4, 0, p.size*0.25, p.size*0.14, 0, 0, Math.PI*2);
        sakCtx.fill();
        sakCtx.restore();
      }
    }
    sakCtx.restore();
    
    p.y += p.speedY;
    p.x += p.speedX;
    p.angle += p.spin;
    
    if (p.y > containerHeight + 30) {
      p.y = -20;
      p.x = Math.random() * containerWidth;
    }
    if (p.x < -30) p.x = containerWidth + 20;
    if (p.x > containerWidth + 30) p.x = -20;
  });
  
  sakuraAnimationFrame = requestAnimationFrame(drawSakuraInside);
}

function handleResize() {
  if (resizeTimeout) clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => initSakuraDimensions(), 100);
}

function setupSakuraContainer() {
  setTimeout(() => {
    if (initSakuraDimensions()) {
      if (sakuraAnimationFrame) cancelAnimationFrame(sakuraAnimationFrame);
      drawSakuraInside();
    }
  }, 100);
  
  if (window.ResizeObserver) {
    const container = document.querySelector('.main-container');
    if (container) {
      const resizeObserver = new ResizeObserver(entries => {
        for (let entry of entries) {
          const { width, height } = entry.contentRect;
          if (width > 0 && height > 0) initSakuraDimensions();
        }
      });
      resizeObserver.observe(container);
      window.sakuraResizeObserver = resizeObserver;
    }
  } else {
    window.addEventListener('resize', handleResize);
  }
}

window.addEventListener('load', function() {
  initSakuraDimensions();
});

document.addEventListener('DOMContentLoaded', function() {
  setupSakuraContainer();
});

window.addEventListener('beforeunload', function() {
  if (sakuraAnimationFrame) cancelAnimationFrame(sakuraAnimationFrame);
  if (window.sakuraResizeObserver) window.sakuraResizeObserver.disconnect();
  if (resizeTimeout) clearTimeout(resizeTimeout);
});

// === FIREWORKS ===
class Fireworks {
  constructor(canvas) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d');
    this.particles = [];
    this.rockets = [];
    this.isActive = false;
    this.fireworksTimer = null;
    this.fireworksDuration = 5000;
    
    this.resize();
    window.addEventListener('resize', () => this.resize());
  }
  
  resize() {
    this.canvas.width = window.innerWidth;
    this.canvas.height = window.innerHeight;
    this.width = this.canvas.width;
    this.height = this.canvas.height;
  }
  
  start() {
    if (this.isActive) return;
    
    this.isActive = true;
    this.canvas.style.display = 'block';
    
    if (this.fireworksTimer) {
      clearTimeout(this.fireworksTimer);
    }
    
    this.fireworksTimer = setTimeout(() => {
      this.stop();
    }, this.fireworksDuration);
    
    for (let i = 0; i < 6; i++) {
      this.createRocket();
    }
    
    this.rocketInterval = setInterval(() => {
      if (this.isActive && Math.random() < 0.7) {
        this.createRocket();
      }
    }, 250);
    
    this.animate();
  }
  
  stop() {
    this.isActive = false;
    clearInterval(this.rocketInterval);
    clearTimeout(this.fireworksTimer);
    
    setTimeout(() => {
      this.canvas.style.display = 'none';
      this.particles = [];
      this.rockets = [];
    }, 300);
  }
  
  createRocket() {
    const rocket = {
      x: Math.random() * this.width,
      y: this.height,
      vx: (Math.random() - 0.5) * 5,
      vy: -Math.random() * 18 - 12,
      size: Math.random() * 2.5 + 1.5,
      color: this.getRandomFireworkColor(),
      trail: [],
      type: this.getRandomExplosionType(),
      explosionSize: Math.random() * 90 + 110
    };
    this.rockets.push(rocket);
  }
  
  getRandomFireworkColor() {
    const colors = [
      '#FF0000', '#FF9900', '#FFFF00', '#00FF00', '#0099FF', '#9900FF',
      '#FF00FF', '#FFD700', '#FF1493', '#FF69B4', '#00FFFF', '#FFA500'
    ];
    return colors[Math.floor(Math.random() * colors.length)];
  }
  
  getRandomExplosionType() {
    const types = ['circle', 'circle', 'heart', 'star', 'sparkle', 'heart', 'star'];
    return types[Math.floor(Math.random() * types.length)];
  }
  
  explode(rocket) {
    const particleCount = rocket.type === 'heart' ? 85 : rocket.type === 'star' ? 75 : 65;
    
    for (let i = 0; i < particleCount; i++) {
      let angle, speed, shape;
      
      angle = Math.random() * Math.PI * 2;
      speed = Math.random() * 8 + 4;
      
      if (rocket.type === 'heart') {
        shape = 'heart';
      } else if (rocket.type === 'star') {
        shape = 'star';
      } else if (rocket.type === 'sparkle') {
        shape = 'sparkle';
      } else {
        shape = 'circle';
      }
      
      const particle = {
        x: rocket.x,
        y: rocket.y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed,
        size: Math.random() * 3.15 + 1.05,
        color: Math.random() < 0.3 ? rocket.color : this.getRandomFireworkColor(),
        life: 100 + Math.random() * 50,
        decay: Math.random() * 0.06 + 0.04,
        gravity: 0.08,
        flicker: Math.random() > 0.7,
        shape: shape,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.4,
        glow: Math.random() > 0.5
      };
      this.particles.push(particle);
    }
  }
  
  drawHeart(x, y, size) {
    this.ctx.save();
    this.ctx.beginPath();
    this.ctx.moveTo(x, y + size/4);
    this.ctx.bezierCurveTo(x - size/2, y - size/2, x - size, y + size/4, x, y + size);
    this.ctx.bezierCurveTo(x + size, y + size/4, x + size/2, y - size/2, x, y + size/4);
    this.ctx.closePath();
    this.ctx.fill();
    this.ctx.restore();
  }
  
  drawStar(x, y, outerRadius, innerRadius, points) {
    this.ctx.save();
    this.ctx.beginPath();
    for (let i = 0; i < points * 2; i++) {
      const angle = (i * Math.PI) / points;
      const radius = i % 2 === 0 ? outerRadius : innerRadius;
      const px = x + Math.cos(angle) * radius;
      const py = y + Math.sin(angle) * radius;
      if (i === 0) this.ctx.moveTo(px, py);
      else this.ctx.lineTo(px, py);
    }
    this.ctx.closePath();
    this.ctx.fill();
    this.ctx.restore();
  }
  
  drawSparkle(x, y, size) {
    this.ctx.save();
    this.ctx.beginPath();
    for (let i = 0; i < 8; i++) {
      const angle = (i * Math.PI) / 4;
      const px = x + Math.cos(angle) * size;
      const py = y + Math.sin(angle) * size;
      if (i === 0) this.ctx.moveTo(px, py);
      else this.ctx.lineTo(px, py);
      this.ctx.lineTo(x + Math.cos(angle + Math.PI/8) * size * 0.5, 
                     y + Math.sin(angle + Math.PI/8) * size * 0.5);
    }
    this.ctx.closePath();
    this.ctx.fill();
    this.ctx.restore();
  }
  
  drawParticle(particle) {
    this.ctx.save();
    if (particle.glow && particle.life > 30) {
      this.ctx.shadowColor = particle.color;
      this.ctx.shadowBlur = 10;
      this.ctx.shadowOffsetX = 0;
      this.ctx.shadowOffsetY = 0;
    }
    this.ctx.globalAlpha = particle.life / 100;
    this.ctx.fillStyle = particle.color;
    this.ctx.translate(particle.x, particle.y);
    this.ctx.rotate(particle.rotation);
    if (particle.shape === 'heart') {
      this.drawHeart(0, 0, particle.size * 2.1);
    } else if (particle.shape === 'star') {
      this.drawStar(0, 0, particle.size * 1.58, particle.size * 0.84, 5);
    } else if (particle.shape === 'sparkle') {
      this.drawSparkle(0, 0, particle.size * 1.58);
    } else {
      this.ctx.beginPath();
      this.ctx.arc(0, 0, particle.size * 1.05, 0, Math.PI * 2);
      this.ctx.fill();
    }
    this.ctx.restore();
  }
  
  drawRocket(rocket) {
    rocket.trail.forEach((trail, index) => {
      this.ctx.beginPath();
      this.ctx.fillStyle = rocket.color;
      this.ctx.globalAlpha = index / rocket.trail.length * 0.7;
      this.ctx.arc(trail.x, trail.y, rocket.size * (1 - index/rocket.trail.length), 0, Math.PI * 2);
      this.ctx.fill();
    });
    this.ctx.save();
    this.ctx.shadowColor = rocket.color;
    this.ctx.shadowBlur = 10.5;
    this.ctx.shadowOffsetX = 0;
    this.ctx.shadowOffsetY = 0;
    this.ctx.beginPath();
    this.ctx.fillStyle = rocket.color;
    this.ctx.globalAlpha = 1;
    this.ctx.arc(rocket.x, rocket.y, rocket.size, 0, Math.PI * 2);
    this.ctx.fill();
    this.ctx.restore();
    rocket.trail.push({x: rocket.x, y: rocket.y});
    if (rocket.trail.length > 10) rocket.trail.shift();
  }
  
  animate() {
    if (!this.isActive) return;
    this.ctx.clearRect(0, 0, this.width, this.height);
    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    this.ctx.fillRect(0, 0, this.width, this.height);
    for (let i = this.rockets.length - 1; i >= 0; i--) {
      const rocket = this.rockets[i];
      rocket.x += rocket.vx;
      rocket.y += rocket.vy;
      rocket.vy += 0.12;
      this.drawRocket(rocket);
      if (rocket.vy >= -0.2 || rocket.y < this.height * 0.3) {
        this.explode(rocket);
        this.rockets.splice(i, 1);
      }
    }
    for (let i = this.particles.length - 1; i >= 0; i--) {
      const particle = this.particles[i];
      particle.x += particle.vx;
      particle.y += particle.vy;
      particle.vy += particle.gravity;
      particle.vx *= 0.96;
      particle.vy *= 0.96;
      particle.life -= particle.decay * 120;
      particle.rotation += particle.rotationSpeed;
      if (particle.flicker) particle.size *= 0.92;
      this.drawParticle(particle);
      if (particle.life <= 0 || particle.size <= 0.3) this.particles.splice(i, 1);
    }
    requestAnimationFrame(() => this.animate());
  }
}

const fireworksCanvas = document.getElementById('fireworksCanvas');
const fireworks = new Fireworks(fireworksCanvas);

// === FORMATTING ===

// === ANIMAL ORDER AND SYMBOLS ===
const animals = ["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"];
const chineseSymbol = { 
  Rat:'Èº†', Ox:'Áâõ', Tiger:'Ëôé', Rabbit:'ÂÖî', 
  Dragon:'Èæç', Snake:'Ëõá', Horse:'È¶¨', Goat:'Áæä', 
  Monkey:'Áå¥', Rooster:'Èõû', Dog:'Áãó', Pig:'Ë±¨' 
};

const elements = ["Wood","Fire","Earth","Metal","Water"];
const elementChinese = { Wood:'Êú®', Fire:'ÁÅ´', Earth:'Âúü', Metal:'Èáë', Water:'Ê∞¥' };

// === CHINESE NEW YEAR DATES ===
const chineseNewYear = {
  1900: "1900-01-31", 1901: "1901-02-19", 1902: "1902-02-08", 1903: "1903-01-29",
  1904: "1904-02-16", 1905: "1905-02-04", 1906: "1906-01-25", 1907: "1907-02-13",
  1908: "1908-02-02", 1909: "1909-01-22", 1910: "1910-02-10", 1911: "1911-01-30",
  1912: "1912-02-18", 1913: "1913-02-06", 1914: "1914-01-26", 1915: "1915-02-14",
  1916: "1916-02-03", 1917: "1917-01-23", 1918: "1918-02-11", 1919: "1919-02-01",
  1920: "1920-02-20", 1921: "1921-02-08", 1922: "1922-01-28", 1923: "1923-02-16",
  1924: "1924-02-05", 1925: "1925-01-25", 1926: "1926-02-13", 1927: "1927-02-02",
  1928: "1928-01-23", 1929: "1929-02-10", 1930: "1930-01-30", 1931: "1931-02-17",
  1932: "1932-02-06", 1933: "1933-01-26", 1934: "1934-02-14", 1935: "1935-02-04",
  1936: "1936-01-24", 1937: "1937-02-11", 1938: "1938-01-31", 1939: "1939-02-19",
  1940: "1940-02-08", 1941: "1941-01-27", 1942: "1942-02-15", 1943: "1943-02-05",
  1944: "1944-01-25", 1945: "1945-02-13", 1946: "1946-02-02", 1947: "1947-01-22",
  1948: "1948-02-10", 1949: "1949-01-29", 1950: "1950-02-17", 1951: "1951-02-06",
  1952: "1952-01-27", 1953: "1953-02-14", 1954: "1954-02-03", 1955: "1955-01-24",
  1956: "1956-02-12", 1957: "1957-01-31", 1958: "1958-02-18", 1959: "1959-02-08",
  1960: "1960-01-28", 1961: "1961-02-15", 1962: "1962-02-05", 1963: "1963-01-25",
  1964: "1964-02-13", 1965: "1965-02-02", 1966: "1966-01-21", 1967: "1967-02-09",
  1968: "1968-01-30", 1969: "1969-02-17", 1970: "1970-02-06", 1971: "1971-01-27",
  1972: "1972-02-15", 1973: "1973-02-03", 1974: "1974-01-23", 1975: "1975-02-11",
  1976: "1976-01-31", 1977: "1977-02-18", 1978: "1978-02-07", 1979: "1979-01-28",
  1980: "1980-02-16", 1981: "1981-02-05", 1982: "1982-01-25", 1983: "1983-02-13",
  1984: "1984-02-02", 1985: "1985-02-20", 1986: "1986-02-09", 1987: "1987-01-29",
  1988: "1988-02-17", 1989: "1989-02-06", 1990: "1990-01-27", 1991: "1991-02-15",
  1992: "1992-02-04", 1993: "1993-01-23", 1994: "1994-02-10", 1995: "1995-01-31",
  1996: "1996-02-19", 1997: "1997-02-07", 1998: "1998-01-28", 1999: "1999-02-16",
  2000: "2000-02-05", 2001: "2001-01-24", 2002: "2002-02-12", 2003: "2003-02-01",
  2004: "2004-01-22", 2005: "2005-02-09", 2006: "2006-01-29", 2007: "2007-02-18",
  2008: "2008-02-07", 2009: "2009-01-26", 2010: "2010-02-14", 2011: "2011-02-03",
  2012: "2012-01-23", 2013: "2013-02-10", 2014: "2014-01-31", 2015: "2015-02-19",
  2016: "2016-02-08", 2017: "2017-01-28", 2018: "2018-02-16", 2019: "2019-02-05",
  2020: "2020-01-25", 2021: "2021-02-12", 2022: "2022-02-01", 2023: "2023-01-22",
  2024: "2024-02-10", 2025: "2025-01-29", 2026: "2026-02-17", 2027: "2027-02-06",
  2028: "2028-01-26", 2029: "2029-02-13", 2030: "2030-02-03"
};

// === ZODIAC CALCULATION WITH CNY ===
function getAuthenticZodiac(year, month, day) {
  year = parseInt(year);
  month = parseInt(month);
  day = parseInt(day);
  
  // Get Chinese New Year date for this year
  let cnyDate = chineseNewYear[year];
  if (!cnyDate) {
    // Fallback for years not in our table
    const animalIndex = ((year - 1900) % 12 + 12) % 12;
    return animals[animalIndex];
  }
  
  const cny = new Date(cnyDate);
  const birthDate = new Date(year, month - 1, day);
  
  // If born before Chinese New Year, use previous year's zodiac
  if (birthDate < cny) {
    year = year - 1;
  }
  
  const animalIndex = ((year - 1900) % 12 + 12) % 12;
  return animals[animalIndex];
}

// === ELEMENT CALCULATION ===
function getAuthenticElement(year, month, day) {
  year = parseInt(year);
  month = parseInt(month);
  day = parseInt(day);
  
  let cnyDate = chineseNewYear[year];
  if (cnyDate) {
    const cny = new Date(cnyDate);
    const birthDate = new Date(year, month - 1, day);
    if (birthDate < cny) {
      year = year - 1;
    }
  }
  
  //  10-year stem cycle
  const stemIndex = ((year - 4) % 10 + 10) % 10;
  
  if (stemIndex === 0 || stemIndex === 1) return "Wood";
  if (stemIndex === 2 || stemIndex === 3) return "Fire";
  if (stemIndex === 4 || stemIndex === 5) return "Earth";
  if (stemIndex === 6 || stemIndex === 7) return "Metal";
  if (stemIndex === 8 || stemIndex === 9) return "Water";
  
  return "Wood";
}

// === FAMOUS PEOPLe ===
const famousPeople = {
  "Rat": ["Severus Snape: born on January 9, 1960, a Metal Rat Èº†", "Wolfgang Amadeus Mozart: born on January 27, 1756, a Fire Rat Èº†", "Samuel L. Jackson: born on December 21, 1948, an Earth Rat Èº†", "Avril Lavigne: born on September 27, 1984, a Wood Rat Èº†", "Tom Holland: born on June 1, 1996, a Fire Rat Èº†"],
  "Ox": ["Barack Obama: born on August 4, 1961, a Metal Ox Áâõ", "Vincent Van Gogh: born on March 30, 1853, a Water Ox Áâõ", "Walt Disney: born on December 5, 1901, a Metal Ox Áâõ", "Meryl Streep: born on June 22, 1949, an Earth Ox Áâõ"],
  "Tiger": ["Leonardo DiCaprio: born on November 11, 1974, a Wood Tiger Ëôé", "Tom Marvolo Riddle: born on December 31, 1926, a Fire Tiger Ëôé", "Audrey Hepburn: born on May 4, 1929, an Earth Tiger Ëôé", "Lady Gaga: born on March 28, 1986, a Fire Tiger Ëôé", "Taylor Swift: born on December 13, 1989, an Earth Tiger Ëôé"],
  "Rabbit": ["Albert Einstein: born on March 14, 1879, an Earth Rabbit ÂÖî", "Keanu Reeves: born on September 2, 1964, a Wood Rabbit ÂÖî", "Emma Watson: born on April 15, 1990, a Metal Rabbit ÂÖî", "Indiana Jones: born on July 1, 1899, an Earth Rabbit ÂÖî"],
  "Dragon": ["Bruce Lee: born on November 27, 1940, a Metal Dragon Èæç", "John Lennon: born on October 9, 1940, a Metal Dragon Èæç", "Rihanna: born on February 20, 1988, an Earth Dragon Èæç", "Sandra Bullock: born on July 26, 1964, a Wood Dragon Èæç", "Kendrick Lamar: born on June 17, 1987, a Fire Dragon Èæç"],
  "Snake": ["Pablo Picasso: born on October 25, 1881, a Metal Snake Ëõá", "Bob Dylan: born on May 24, 1941, a Metal Snake Ëõá", "Halle Berry: born on August 14, 1966, a Fire Snake Ëõá"],
  "Horse": ["Princess Diana: born on July 1, 1961, a Metal Horse È¶¨", "Paul McCartney: born on June 18, 1942, a Water Horse È¶¨", "Neil Armstrong: born on August 5, 1930, a Metal Horse È¶¨"],
  "Goat": ["Steve Jobs: born on February 24, 1955, an Earth Goat Áæä", "Billie Eilish: born on December 18, 2001, a Metal Goat Áæä", "Hermione Jean Granger: born on September 19, 1979, a Earth Goat Áæä", "Chris Hemsworth: born on August 11, 1983, a Water Goat Áæä"],
  "Monkey": ["Leonardo da Vinci: born on April 15, 1452, a Wood Monkey Áå¥", "Angelina Jolie: born on June 4, 1975, a Wood Monkey Áå¥", "Harry James Potter: born on July 31, 1980, a Metal Monkey Áå¥", "Diana Ross: born on March 26, 1944, a Wood Monkey Áå¥", "Marty McFly: born on June 12, 1968, an Earth Monkey Áå¥"],
  "Rooster": ["Jennifer Aniston: born on February 11, 1969, an Earth Rooster Èõû", "Benedict Cumberbatch: born on July 19, 1976, a Fire Rooster Èõû", "Beyonc√©: born on September 4, 1981, a Metal Rooster Èõû", "Anne Hathaway: born on November 12, 1982, a Water Rooster Èõû", "Robert Downey Jr: born on April 4, 1965, a Wood Rooster Èõû"],
  "Dog": ["Elvis Presley: born on January 8, 1935, a Wood Dog Áãó", "Michael Jackson: born on August 29, 1958, an Earth Dog Áãó", "Morgan Freeman: born on June 1, 1937, a Fire Dog Áãó", "Adam Sandler: born on September 9, 1966, a Fire Dog Áãó", "Eminem: born on October 17, 1972, a Water Dog Áãó", "Lin‚ÄëManuel Miranda: born on January 16, 1980, a Metal Dog Áãó", "Jerry Springer: born on February 13, 1944, a Wood Dog Áãó", "Maury Povich: born on January 17, 1939, an Earth Dog Áãó"],
  "Pig": ["Barbra Streisand: born on April 24, 1942, a Water Pig Ë±¨", "Henry Cavill: born on May 5, 1983, a Water Pig Ë±¨", "Cristiano Ronaldo: born on February 5, 1985, a Wood Pig Ë±¨", "Jackie Chan: born on April 7, 1954, a Wood Pig Ë±¨", "Bad Bunny: born on March 10, 1994, a Wood Pig Ë±¨", "Daniel Radcliffe: born on July 23, 1989, an Earth Pig Ë±¨", "Lucy Liu: born on December 2, 1968, an Earth Pig Ë±¨"]
};

// === STORY ===
const zodiacStory = {
  "Rat": "The Rat won the race by riding on the Ox's back and jumping off at the last moment. Rats represent intelligence and wealth in Chinese culture. People born in Rat years are quick-witted and resourceful.",
  "Ox": "The Ox finished second, swimming steadily across the river. Oxen represent diligence and strength. Those born in Ox years are patient, methodical, and dependable.",
  "Tiger": "The Tiger finished third, using its strength to fight the current. Tigers symbolize bravery and power. Tiger-year individuals are courageous and competitive.",
  "Rabbit": "The Rabbit crossed by hopping from stone to stone. Rabbits represent grace and diplomacy. Rabbit-year people are elegant and peaceful.",
  "Dragon": "The Dragon flew downwind, arriving fifth. Dragons symbolize imperial power and good fortune. Dragon-year individuals are charismatic and ambitious.",
  "Snake": "The Snake hitched a ride on the Horse's hoof, arriving sixth. Snakes represent wisdom and mystery. Snake-year people are philosophical and intuitive.",
  "Horse": "The Horse ran fast but was startled by the Snake, coming seventh. Horses symbolize freedom and energy. Horse-year individuals are independent and cheerful.",
  "Goat": "The Goat, Monkey, and Rooster helped each other on a raft. The Goat arrived eighth. Goats symbolize harmony and creativity.",
  "Monkey": "The Monkey helped steer the raft, arriving ninth. Monkeys represent intelligence and playfulness. Monkey-year people are witty and inventive.",
  "Rooster": "The Rooster spotted the shore from the raft, arriving tenth. Roosters symbolize punctuality and honesty.",
  "Dog": "The Dog, playing in the water, came eleventh. Dogs represent loyalty and justice. Dog-year individuals are honest and faithful.",
  "Pig": "The Pig stopped to eat and rest, arriving last. Pigs symbolize generosity and abundance. Pig-year people are sincere and tolerant."
};

// Chinese greetings
const chineseGreetings = [
  "G≈çngx«ê fƒÅc√°i (ÊÅ≠ÂñúÁôºË≤°) - Wishing you prosperity",
  "Xƒ´nni√°n ku√†il√® (Êñ∞Âπ¥Âø´Ê®Ç) - Happy New Year",
  "J√≠xi√°ng r√∫y√¨ (ÂêâÁ••Â¶ÇÊÑè) - Good luck and happiness",
  "W√†nsh√¨ r√∫y√¨ (Ëê¨‰∫ãÂ¶ÇÊÑè) - May all your wishes come true",
  "Shƒìnt«ê ji√†nkƒÅng (Ë∫´È´îÂÅ•Â∫∑) - Good health",
  "Ni√°nni√°n y«íuy√∫ (Âπ¥Âπ¥ÊúâÈ§ò) - Abundance year after year"
];

// Chinese hours
const chineseHours = {
  "Rat": "11 PM - 1 AM (Â≠êÊôÇ - Zishi)",
  "Ox": "1 AM - 3 AM (‰∏ëÊôÇ - Choushi)",
  "Tiger": "3 AM - 5 AM (ÂØÖÊôÇ - Yinshi)",
  "Rabbit": "5 AM - 7 AM (ÂçØÊôÇ - Maoshi)",
  "Dragon": "7 AM - 9 AM (Ëæ∞ÊôÇ - Chenshi)",
  "Snake": "9 AM - 11 AM (Â∑≥ÊôÇ - Sishi)",
  "Horse": "11 AM - 1 PM (ÂçàÊôÇ - Wushi)",
  "Goat": "1 PM - 3 PM (Êú™ÊôÇ - Weishi)",
  "Monkey": "3 PM - 5 PM (Áî≥ÊôÇ - Shenshi)",
  "Rooster": "5 PM - 7 PM (ÈÖâÊôÇ - Youshi)",
  "Dog": "7 PM - 9 PM (ÊàåÊôÇ - Xushi)",
  "Pig": "9 PM - 11 PM (‰∫•ÊôÇ - Haishi)"
};

// === LUCKY DATA ===
const luckyData = {
  "Rat": { 
    numbers: [2, 3], 
    colors: ["Blue (calm)", "Gold (wealth)", "Green (growth)"], 
    flowers: ["Lily (purity & wealth)", "African Violet (elegance)", "Lily of the Valley (sweetness)"],
    directions: ["Northeast (career luck)", "Due West (relationship luck)", "Southwest (health luck)"],
    bestWith: ["Dragon", "Monkey", "Ox"], 
    avoid: ["Horse", "Goat"]
  },
  "Ox": { 
    numbers: [1, 4, 6], 
    colors: ["Yellow (stability)", "Green (harmony)"], 
    flowers: ["Peony (wealth & honor)", "Tulip (perfect love)", "Plum Blossom (resilience)"],
    directions: ["Due North (career success)", "Southeast (wealth luck)"],
    bestWith: ["Rat", "Rooster", "Snake"], 
    avoid: ["Goat", "Horse"]
  },
  "Tiger": { 
    numbers: [1, 3, 4], 
    colors: ["Blue (trust)", "Gray (balance)", "White (purity)"], 
    flowers: ["Orchid (nobility)", "Anthurium (hospitality)", "Azalea (passion)"],
    directions: ["Northeast (power)", "Due South (fame)", "Northwest (helpful people)"],
    bestWith: ["Horse", "Dog", "Pig"], 
    avoid: ["Monkey", "Snake"]
  },
  "Rabbit": { 
    numbers: [3, 4, 6], 
    colors: ["Red (vitality)", "Pink (romance)", "Purple (spirituality)"], 
    flowers: ["Jasmine (friendship)", "Lotus (purity)", "Osmanthus (success)"],
    directions: ["Due East (health)", "Southeast (wealth)", "Due South (recognition)"],
    bestWith: ["Goat", "Pig", "Dog"], 
    avoid: ["Rooster", "Rat"]
  },
  "Dragon": { 
    numbers: [1, 6, 7], 
    colors: ["Gold (success)", "Silver (intuition)", "Grayish White (purity)"], 
    flowers: ["Clerodendrum (dragon's power)", "Cactus Flower (protection)", "Gladiolus (strength)"],
    directions: ["Due East (growth)", "Southeast (prosperity)", "Due North (career)"],
    bestWith: ["Rat", "Monkey", "Rooster"], 
    avoid: ["Dog", "Rabbit"]
  },
  "Snake": { 
    numbers: [2, 8, 9], 
    colors: ["Black (mystery)", "Red (passion)", "Yellow (wisdom)"], 
    flowers: ["Orchid (refinement)", "Red Rose (love)", "Cactus (protection)"],
    directions: ["Southeast (wisdom)", "South (passion)", "Southwest (relationships)"],
    bestWith: ["Rooster", "Ox", "Monkey"], 
    avoid: ["Pig", "Tiger"]
  },
  "Horse": { 
    numbers: [2, 3, 7], 
    colors: ["Yellow (optimism)", "Green (growth)", "Brown (stability)"], 
    flowers: ["Carnation (energy)", "Chrysanthemum (longevity)", "Sunflower (happiness)"],
    directions: ["South (recognition)", "Southwest (romance)", "West (creativity)"],
    bestWith: ["Tiger", "Goat", "Dog"], 
    avoid: ["Rat", "Ox"]
  },
  "Goat": { 
    numbers: [2, 7], 
    colors: ["Green (peace)", "Red (vitality)", "Purple (spirituality)"], 
    flowers: ["Carnation (love)", "Gladiolus (integrity)", "Primrose (youthfulness)"],
    directions: ["Southwest (relationships)", "West (creativity)", "Northwest (helpful people)"],
    bestWith: ["Rabbit", "Horse", "Pig"], 
    avoid: ["Ox", "Rat"]
  },
  "Monkey": { 
    numbers: [4, 9], 
    colors: ["White (clarity)", "Gold (wealth)", "Blue (communication)"], 
    flowers: ["Orchid (intelligence)", "Chrysanthemum (cheerfulness)", "Carnation (versatility)"],
    directions: ["West (social luck)", "Northwest (opportunities)", "North (career)"],
    bestWith: ["Dragon", "Rat", "Snake"], 
    avoid: ["Tiger", "Pig"]
  },
  "Rooster": { 
    numbers: [5, 7, 8], 
    colors: ["Gold (success)", "Brown (reliability)", "Yellow (confidence)"], 
    flowers: ["Gladiolus (strength)", "Cockscomb (vitality)", "Marigold (protection)"],
    directions: ["West (creativity)", "Northwest (opportunities)", "South (recognition)"],
    bestWith: ["Ox", "Snake", "Dragon"], 
    avoid: ["Rabbit", "Dog"]
  },
  "Dog": { 
    numbers: [3, 4, 9], 
    colors: ["Red (passion)", "Green (growth)", "Purple (spirituality)"], 
    flowers: ["Rose (loyalty)", "Chrysanthemum (honesty)", "Orchid (nobility)"],
    directions: ["Northwest (helpful people)", "East (family)", "South (fame)"],
    bestWith: ["Tiger", "Horse", "Rabbit"], 
    avoid: ["Dragon", "Rooster"]
  },
  "Pig": { 
    numbers: [2, 5, 8], 
    colors: ["Yellow (optimism)", "Gray (balance)", "Brown (stability)"], 
    flowers: ["Hydrangea (gratitude)", "Daisy (innocence)", "Calla Lily (beauty)"],
    directions: ["North (career)", "Northeast (knowledge)", "South (social)"],
    bestWith: ["Rabbit", "Goat", "Tiger"], 
    avoid: ["Snake", "Monkey"]
  }
};

// === ZODIAC YEARS TABLE ===
const zodiacYears = {
  "Rat": { 
    "Wood":[1924,1984,2044],
    "Fire":[1936,1996,2056],
    "Earth":[1948,2008,2068],
    "Metal":[1960,2020,2080],
    "Water":[1912,1972,2032] 
  },
  "Ox": { 
    "Wood":[1925,1985,2045],
    "Fire":[1937,1997,2057],
    "Earth":[1949,2009,2069],
    "Metal":[1961,2021,2081],
    "Water":[1913,1973,2033] 
  },
  "Tiger": { 
    "Wood":[1914,1974,2034],
    "Fire":[1926,1986,2046],
    "Earth":[1938,1998,2058],
    "Metal":[1950,2010,2070],
    "Water":[1962,2022,2082] 
  },
  "Rabbit": { 
    "Wood":[1915,1975,2035],
    "Fire":[1927,1987,2047],
    "Earth":[1939,1999,2059],
    "Metal":[1951,2011,2071],
    "Water":[1963,2023,2083] 
  },
  "Dragon": { 
    "Wood":[1904,1964,2024],
    "Fire":[1916,1976,2036],
    "Earth":[1928,1988,2048],
    "Metal":[1940,2000,2060],
    "Water":[1952,2012,2072] 
  },
  "Snake": { 
    "Wood":[1905,1965,2025],
    "Fire":[1917,1977,2037],
    "Earth":[1929,1989,2049],
    "Metal":[1941,2001,2061],
    "Water":[1953,2013,2073] 
  },
  "Horse": { 
    "Wood":[1954,2014,2074],
    "Fire":[1906,1966,2026],
    "Earth":[1918,1978,2038],
    "Metal":[1930,1990,2050],
    "Water":[1942,2002,2062] 
  },
  "Goat": { 
    "Wood":[1955,2015,2075],
    "Fire":[1907,1967,2027],
    "Earth":[1919,1979,2039],
    "Metal":[1931,1991,2051],
    "Water":[1943,2003,2063] 
  },
  "Monkey": { 
    "Wood":[1944,2004,2064],
    "Fire":[1956,2016,2076],
    "Earth":[1908,1968,2028],
    "Metal":[1920,1980,2040],
    "Water":[1932,1992,2052] 
  },
  "Rooster": { 
    "Wood":[1945,2005,2065],
    "Fire":[1957,2017,2077],
    "Earth":[1909,1969,2029],
    "Metal":[1921,1981,2041],
    "Water":[1933,1993,2053] 
  },
  "Dog": { 
    "Wood":[1934,1994,2054],
    "Fire":[1946,2006,2066],
    "Earth":[1910,1970,2030],
    "Metal":[1922,1982,2042],
    "Water":[1958,2018,2078] 
  },
  "Pig": { 
    "Wood":[1935,1995,2055],
    "Fire":[1947,2007,2067],
    "Earth":[1911,1971,2031],
    "Metal":[1923,1983,2043],
    "Water":[1959,2019,2079] 
  }
};

// Element colors (your original)
const elementColors = {
  "Wood": "#F0E2C9",
  "Fire": "#fffafb",
  "Earth": "#E8EDD0",
  "Metal": "#F0F0F0",
  "Water": "#DEF0FA"
};

// Element descriptions (your original)
const elementDescriptions = {
  "Wood": "Wood represents growth, creativity, and flexibility. Wood signs are visionary, idealistic, and able to see the big picture.",
  "Fire": "Fire represents passion, energy, and transformation. Fire signs are enthusiastic, dynamic, and natural leaders.",
  "Earth": "Earth represents stability, practicality, and reliability. Earth signs are grounded, patient, and hardworking.",
  "Metal": "Metal represents structure, determination, and strength. Metal signs are disciplined, resolute, and value integrity.",
  "Water": "Water represents wisdom, intuition, and adaptability. Water signs are perceptive, empathetic, and deeply emotional."
};

// ===FORMATTING ===
let originalReelsHTML = null;
let isSpinning = false;
let resultsShown = false;

function getRandomGreeting() {
  return chineseGreetings[Math.floor(Math.random() * chineseGreetings.length)];
}

function addChineseCharacter(animal) {
  return `${animal} <span class="chinese-char">${chineseSymbol[animal]}</span>`;
}

function hideResults() {
  const tabsWrapper = document.querySelector('.tabs-wrapper');
  tabsWrapper.classList.remove('active');
  resultsShown = false;
  
  const reelsDiv = document.getElementById("reels");
  if (!document.getElementById("reel1") && originalReelsHTML) {
    reelsDiv.innerHTML = originalReelsHTML;
    initReels();
  }
}

function initBirthdayDropdowns(){
  const month = document.getElementById("month");
  const day = document.getElementById("day");
  const year = document.getElementById("year");
  
  const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
  months.forEach((m, i) => {
    const option = new Option(m, i + 1);
    month.add(option);
  });
  
  for(let d = 1; d <= 31; d++) {
    day.add(new Option(d, d));
  }
  
  // Years from 1900 to 2026
  for(let y = 2026; y >= 1900; y--) {
    year.add(new Option(y, y));
  }
  
  // Set default to TODAY: February 12, 2026
  month.value = 2;
  day.value = 12;
  year.value = 2026;
  
  month.addEventListener('change', hideResults);
  day.addEventListener('change', hideResults);
  year.addEventListener('change', hideResults);
}

// === USER ZODIAC FUNCTION ===
function getUserZodiacFromDropdown(){
  const y = parseInt(document.getElementById("year").value);
  const m = parseInt(document.getElementById("month").value);
  const d = parseInt(document.getElementById("day").value);
  
  const animal = getAuthenticZodiac(y, m, d);
  const element = getAuthenticElement(y, m, d);
  
  return {animal: animal, element: element, year: y};
}

// === GENERATE ZODIAC TEXT ===
function generateZodiacText(animal, element, year){
  const animalWithChinese = addChineseCharacter(animal);
  const elementWithChinese = `${element} <span class="chinese-char">${elementChinese[element]}</span>`;
  
  const lucky = luckyData[animal];
  const hours = chineseHours[animal];
  const greeting = getRandomGreeting();
  
  // 1. General Info - YOUR EXACT FORMATTING WITH FLOWERS
  let generalText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
                <strong>Your Zodiac: ${elementWithChinese} ${animalWithChinese} (${year})</strong>
              </div>
              <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
              <div style="font-size: 0.95em; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
                <strong>Personality Traits:</strong><br>
                ${zodiacStory[animal]}
                
                <div class="lucky-section">
                  <strong>üóìÔ∏è Chinese Hour:</strong> ${hours}<br>
                  <strong>üéØ Lucky Numbers:</strong> ${lucky.numbers.join(', ')}<br>
                  <strong>üé® Lucky Colors:</strong> ${lucky.colors.join(', ')}<br>
                  <strong>üå∏ Lucky Flowers:</strong> ${lucky.flowers.join(', ')}<br>
                  <strong>üß≠ Lucky Directions:</strong> ${lucky.directions.join(', ')}<br>
                  <strong>‚ù§Ô∏è Best Matches:</strong> ${lucky.bestWith.join(', ')}<br>
                  <strong>‚ö†Ô∏è Avoid:</strong> ${lucky.avoid.join(', ')}
                </div>
                
                <div style="background: #FFE39E; padding: 10px; border-radius: 6px; border-left: 4px solid #be3838;">
                  <strong>üéä Chinese Blessing:</strong> ${greeting}
                </div>
                <br>
                <em style="font-size: 0.85em; color: #666;">Note: Chinese New Year falls between Jan 21-Feb 20. If born in Jan/Feb, you might be previous year's zodiac.</em>
              </div>`;
  
  // 2. Story - STORY
  const storyText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            <strong>The Legend of the ${animalWithChinese}</strong>
          </div>
          <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
          <div style="font-size: 0.95em; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            <p>In the Jade Emperor's great race, ${zodiacStory[animal]}</p>
            <br>
            <div style="background: #ffe6e9; padding: 10px; border-radius: 6px; border-left: 4px solid #be3838;">
              <strong>Compatibility:</strong><br>
              ${lucky.bestWith.length > 0 ? 'Best matches: ' + lucky.bestWith.join(', ') : ''}<br>
              ${lucky.avoid.length > 0 ? 'Avoid: ' + lucky.avoid.join(', ') : ''}
            </div>
          </div>`;
  
  // 3. Elements - USING YOUR FORMATTING
  let elementsText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
                <strong>Chinese Zodiac Elements & Years for ${animalWithChinese}</strong>
              </div>
              <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
              <div style="font-size: 0.95em; line-height: 1.4; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">`;
  
  const orderedElements = [element];
  elements.forEach(el => {
    if (el !== element) orderedElements.push(el);
  });
  
  orderedElements.forEach(el => {
    const isCurrent = el === element;
    const yearsForElement = zodiacYears[animal] && zodiacYears[animal][el] ? 
      zodiacYears[animal][el].filter(y => y <= 2100 && y >= 1900) : [];
    
    const elementColor = elementColors[el];
    const borderColor = isCurrent ? '#be3838' : '#972525';
    
    elementsText += `<div style="margin-bottom: 15px; padding: 10px; background: ${elementColor}; border-radius: 6px; border-left: 4px solid ${borderColor}; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
              <strong>${el} <span class="chinese-char">${elementChinese[el]}</span></strong><br>
              ${elementDescriptions[el]}<br><br>
              <strong>${el} ${elementChinese[el]} ${animalWithChinese} Years:</strong><br>
              ${yearsForElement.length > 0 ? yearsForElement.join(', ') : 'No years available for this element'}
              ${isCurrent ? '<br><br><em style="color: #be3838; font-size: 1.2em; font-weight: bold;">‚úì Your element & year</em>' : ''}
            </div>`;
  });
  
  elementsText += "</div>";
  
  // 4. Famous People - USING DATA
  const animalPlural = animal === "Ox" ? "Oxen" : 
                      animal === "Goat" ? "Goats" :
                      animal.endsWith("s") || animal.endsWith("x") || animal.endsWith("ch") || animal.endsWith("sh") ? 
                      animal + "es" : animal + "s";
  
  const famousText = `<div style="font-size: 1em; margin-bottom: 10px; color: #be3838; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            <strong>Famous ${animalPlural} ${chineseSymbol[animal]}</strong>
          </div>
          <hr style="border: none; height: 1px; background-color: #972525; margin: 10px 0;">
          <div style="font-size: 0.9em; line-height: 1.3; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; white-space: normal;">
            ${famousPeople[animal].join("<br>")}
          </div>`;
  
  document.getElementById("general").innerHTML = generalText;
  document.getElementById("story").innerHTML = storyText;
  document.getElementById("elements").innerHTML = elementsText;
  document.getElementById("famous").innerHTML = famousText;
}

function initReels(){
  const reelContainers = document.querySelectorAll('.reel-container');
  if (reelContainers.length === 0) return;
  
  const reelHeight = reelContainers[0].offsetHeight;
  
  for(let i = 1; i <= 3; i++){
    const reel = document.getElementById("reel" + i);
    if (!reel) continue;
    
    reel.innerHTML = "";
    
    for(let cycle = 0; cycle < 2; cycle++) {
      animals.forEach(animal => {
        const img = document.createElement("img");
        img.src = `images/${animal}.png`;
        img.alt = animal;
        img.loading = "lazy";
        img.onerror = function(){
          this.src = `images/${animal.replace(/\s+/g,'')}.png`;
        };
        reel.appendChild(img);
      });
    }
    
    reel.style.top = "0px";
    reel.dataset.cycleHeight = reel.children.length * reelHeight;
  }
}

function collapseToSingleSlot(animal){
  const reels = document.getElementById("reels");
  reels.style.opacity = "0.5";
  
  setTimeout(() => {
    reels.innerHTML = "";
    
    const container = document.createElement("div");
    container.className = 'reel-container single';
    
    const img = document.createElement("img");
    img.className = 'single-photo';
    img.src = `images/${animal}.png`;
    img.alt = `${animal} zodiac sign`;
    img.loading = "lazy";
    img.onerror = function(){
      this.src = `images/${animal.replace(/\s+/g,'')}.png`;
    };
    
    const overlay = document.createElement("img");
    overlay.className = 'overlay';
    overlay.src = 'images/overlay.png';
    overlay.alt = "Slot machine overlay";
    
    container.appendChild(img);
    container.appendChild(overlay);
    reels.appendChild(container);
    
    reels.style.opacity = "1";
    document.querySelector('.tabs-wrapper').classList.add('active');
    resultsShown = true;
    
    setTimeout(() => {
      fireworks.stop();
    }, 5000);
    
    if (window.innerWidth < 768) {
      setTimeout(() => {
        document.querySelector('.tabs-wrapper').scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }, 500);
    }
  }, 400);
}

function startSpin(){
  if (isSpinning) return;
  isSpinning = true;
  
  const spinButton = document.getElementById("spinButton");
  spinButton.disabled = true;
  spinButton.style.opacity = "0.7";
  spinButton.innerHTML = '<span class="gold">Spinning...</span>';
  
  fireworks.start();
  
  const reelsDiv = document.getElementById("reels");
  
  if (!document.getElementById("reel1") && originalReelsHTML) {
    reelsDiv.innerHTML = originalReelsHTML;
    initReels();
  }
  
  const {animal, element, year} = getUserZodiacFromDropdown();
  
  const reels = [
    document.getElementById("reel1"),
    document.getElementById("reel2"),
    document.getElementById("reel3")
  ].filter(reel => reel !== null);
  
  const targetIndex = animals.indexOf(animal);
  const spinDurations = [1800, 2400, 3000];
  let completedSpins = 0;
  
  reels.forEach((reel, i) => {
    if (!reel) return;
    
    const startTime = Date.now();
    const cycleHeight = parseInt(reel.dataset.cycleHeight) || 2400;
    const step = 14;
    const tickMs = 16;
    
    reel.style.transition = 'none';
    
    const interval = setInterval(() => {
      let top = parseFloat(reel.style.top) || 0;
      top -= step;
      
      if (Math.abs(top) >= cycleHeight / 2) {
        top += cycleHeight / 2;
      }
      
      reel.style.top = top + 'px';
      
      if (Date.now() - startTime >= spinDurations[i]) {
        clearInterval(interval);
        
        const containerHeight = reel.parentElement.offsetHeight;
        reel.style.transition = 'top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)';
        reel.style.top = -(targetIndex + animals.length) * containerHeight + 'px';
        
        completedSpins++;
        
        if (completedSpins === reels.length) {
          const onSettled = function(e) {
            if (e.propertyName !== 'top') return;
            reel.removeEventListener('transitionend', onSettled);
            
            generateZodiacText(animal, element, year);
            collapseToSingleSlot(animal);
            
            setTimeout(() => {
              spinButton.disabled = false;
              spinButton.style.opacity = "1";
              spinButton.innerHTML = '<span class="gold">Discover My Zodiac!</span>';
              isSpinning = false;
            }, 500);
          };
          
          reel.addEventListener('transitionend', onSettled);
        }
      }
    }, tickMs);
  });
}

window.addEventListener('DOMContentLoaded', function() {
  initBirthdayDropdowns();
  initReels();
  originalReelsHTML = document.getElementById("reels").innerHTML;
  
  let resizeTimeout;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      if (document.getElementById("reel1")) {
        initReels();
      }
    }, 250);
  });
  
  const spinButton = document.getElementById('spinButton');
  
  spinButton.addEventListener('touchstart', function() {
    this.style.transform = 'translateY(4px)';
  });
  
  spinButton.addEventListener('touchend', function() {
    this.style.transform = '';
  });
  
  document.querySelectorAll('select').forEach(select => {
    select.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        startSpin();
      }
    });
  });
  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !isSpinning) {
      startSpin();
    }
  });
});
</script>
</body>
</html>
